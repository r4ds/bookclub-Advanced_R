<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 14 R6 | Advanced R Companion</title>
  <meta name="description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 14 R6 | Advanced R Companion" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 R6 | Advanced R Companion" />
  
  <meta name="twitter:description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  

<meta name="author" content="R4DS Reading Group" />


<meta name="date" content="2020-08-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="s3.html"/>
<link rel="next" href="s4.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<img src="images/r4ds.png" style="width:300px;height:180px;padding-bottom:0px;"></img>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="welcome.html"><a href="welcome.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="names-and-values.html"><a href="names-and-values.html"><i class="fa fa-check"></i><b>2</b> Names and Values</a><ul>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#binding-basics"><i class="fa fa-check"></i>2.2 Binding basics</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#copy-on-modify"><i class="fa fa-check"></i>2.3 Copy-on-modify</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>2.2.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#function-calls"><i class="fa fa-check"></i>2.3.2 Function calls</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#lists"><i class="fa fa-check"></i>2.3.3 Lists</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#character-vectors"><i class="fa fa-check"></i>2.3.5 Character vectors</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercise"><i class="fa fa-check"></i>2.3.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#object-size"><i class="fa fa-check"></i>2.4.1 Object size</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#modify-in-place"><i class="fa fa-check"></i>2.5.1 Modify-in-place</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors.html"><a href="vectors.html"><i class="fa fa-check"></i><b>3</b> Vectors</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#scalars"><i class="fa fa-check"></i>3.2.1 Scalars</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#missing-values"><i class="fa fa-check"></i>3.2.3 Missing values</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#testing-and-coercion"><i class="fa fa-check"></i>3.2.4 Testing and coercion</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#setting-attributes"><i class="fa fa-check"></i>3.3.1 Setting Attributes</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#setnames"><i class="fa fa-check"></i>3.3.2 setNames</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#dimensions"><i class="fa fa-check"></i>3.3.3 Dimensions</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#s3-atomic-vectors"><i class="fa fa-check"></i>3.4 S3 atomic vectors</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#dates"><i class="fa fa-check"></i>3.4.2 Dates</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#lists"><i class="fa fa-check"></i>3.5.1 Lists</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#data-frames-and-tibbles"><i class="fa fa-check"></i>3.6.8 Data frames and tibbles</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#conclusion"><i class="fa fa-check"></i>Conclusion</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#vectorized"><i class="fa fa-check"></i>VECTORIZED:</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#non-vectorized"><i class="fa fa-check"></i>NON-VECTORIZED:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#introduction"><i class="fa fa-check"></i>4.1 Introduction</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#selecting-multiple-elements"><i class="fa fa-check"></i>4.2.1 Selecting multiple elements</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#lists"><i class="fa fa-check"></i>4.2.2 lists</a></li>
<li><a href="subsetting.html#section">4.3.1 <code>[[</code></a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercise"><i class="fa fa-check"></i>4.3.5 Exercise</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#missing-and-oob"><i class="fa fa-check"></i>4.3.3 Missing and OOB</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#logical-atomic"><i class="fa fa-check"></i>LOGICAL ATOMIC</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#list"><i class="fa fa-check"></i>LIST</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#null"><i class="fa fa-check"></i>NULL</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#logical-subsetting"><i class="fa fa-check"></i>4.5.8 Logical subsetting</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra"><i class="fa fa-check"></i>4.5.8 Boolean algebra</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-flow.html"><a href="control-flow.html"><i class="fa fa-check"></i><b>5</b> Control Flow</a><ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#vectorised-if"><i class="fa fa-check"></i>5.2.2 Vectorised if</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#loops"><i class="fa fa-check"></i>5.3 Loops</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#switch-statement"><i class="fa fa-check"></i>5.2.3 switch statement</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#common-pitfalls"><i class="fa fa-check"></i>5.3.1 common pitfalls</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>5.3.3.1 Exercises</a><ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#assignment-to-a-valid-index"><i class="fa fa-check"></i>Assignment to a valid index</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#assignment-to-0"><i class="fa fa-check"></i>Assignment to [0]</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#empty-index"><i class="fa fa-check"></i>Empty index</a></li>
<li><a href="control-flow.html#impossible-index">Impossible Index <code>[[</code></a></li>
<li><a href="control-flow.html#impossible-index--">Impossible Index <code>[[&lt;-</code></a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#undefined-name"><i class="fa fa-check"></i>Undefined name</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#out-of-bounds"><i class="fa fa-check"></i>Out of Bounds</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#conclusion"><i class="fa fa-check"></i>Conclusion</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#complexity"><i class="fa fa-check"></i>Complexity</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#primitives"><i class="fa fa-check"></i>6.2.2 Primitives</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>6.2.5.1 Exercises</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i>6.3 Function composition</a><ul>
<li class="chapter" data-level="6.0.1" data-path="functions.html"><a href="functions.html#nested"><i class="fa fa-check"></i><b>6.0.1</b> Nested</a></li>
<li class="chapter" data-level="6.0.2" data-path="functions.html"><a href="functions.html#intermediate"><i class="fa fa-check"></i><b>6.0.2</b> Intermediate</a></li>
<li class="chapter" data-level="6.0.3" data-path="functions.html"><a href="functions.html#piping"><i class="fa fa-check"></i><b>6.0.3</b> Piping</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i>6.4 Lexical scoping</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#a-fresh-start"><i class="fa fa-check"></i>6.4.3 A fresh start</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i>6.5 Lazy evaluation</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i>6.5.1 Promises</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i>6.5.2 Default arguments</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercise"><i class="fa fa-check"></i>6.5.4.3 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-1"><i class="fa fa-check"></i>6.5.4.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#dot-dot-dot"><i class="fa fa-check"></i>6.6 dot dot dot</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-2"><i class="fa fa-check"></i>6.6.1.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exit-handlers"><i class="fa fa-check"></i>6.7.4 Exit handlers</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-3"><i class="fa fa-check"></i>6.7.5.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-4"><i class="fa fa-check"></i>6.7.5.5 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i>6.8.4 Replacement functions</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-5"><i class="fa fa-check"></i>6.8.6.3 Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a><ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i>7.2.3 Parents</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#super-assignment"><i class="fa fa-check"></i>7.2.4 Super assignment</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#getting-and-setting"><i class="fa fa-check"></i>7.2.5 Getting and setting</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i>7.2.6 Advanced bindings</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#recursing-over-environments"><i class="fa fa-check"></i>7.3 Recursing over environments</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>7.3.1.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#function-enviornment"><i class="fa fa-check"></i>7.4.2 Function enviornment</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i>7.4.3 Namespaces</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#call-stacks"><i class="fa fa-check"></i>7.5 Call stacks</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#data-structures"><i class="fa fa-check"></i>7.6 Data Structures</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a><ul>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i>8.3 Ignoring conditions</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i>8.4.2 Exiting handlers</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i>8.4.3 Calling handlers</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>8.4.5.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-1"><i class="fa fa-check"></i>8.4.5.3 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i>8.6.3 Resignal</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i>8.6.4 Record</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-2"><i class="fa fa-check"></i>8.6.6.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-3"><i class="fa fa-check"></i>8.6.6.4 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#slides"><i class="fa fa-check"></i>Slides</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a><ul>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#anonymous-functions-and-shortcuts"><i class="fa fa-check"></i>9.2.2 Anonymous functions and shortcuts</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercise"><i class="fa fa-check"></i>9.2.6.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-1"><i class="fa fa-check"></i>9.2.6.5 Exercise</a></li>
<li><a href="functionals.html#same-type-of-output-as-input-modify">9.4.1 Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#any-number-of-inputs-pmap-and-friends"><i class="fa fa-check"></i>9.4.5 Any number of inputs: pmap() and friends</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-2"><i class="fa fa-check"></i>9.4.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#multiple-inputs"><i class="fa fa-check"></i>9.5.4 Multiple inputs</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-3"><i class="fa fa-check"></i>9.6.3.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#matrices-and-arrays"><i class="fa fa-check"></i>9.7.1 Matrices and arrays</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-4"><i class="fa fa-check"></i>9.7.3.2 Exercise</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>10</b> Function factories</a><ul>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i>10.2 Factory fundamentals</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#forcing-evaluation"><i class="fa fa-check"></i>10.2.3 Forcing evaluation</a></li>
<li class="chapter" data-level="10.1" data-path="function-factories.html"><a href="function-factories.html#without-force"><i class="fa fa-check"></i><b>10.1</b> WITHOUT FORCE</a><ul>
<li class="chapter" data-level="10.1.1" data-path="function-factories.html"><a href="function-factories.html#using-force"><i class="fa fa-check"></i><b>10.1.1</b> USING FORCE</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#garbage-collection"><i class="fa fa-check"></i>10.2.5 garbage collection</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercise"><i class="fa fa-check"></i>10.2.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-1"><i class="fa fa-check"></i>10.2.6.3 Exercise</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i>10.3.1 Labelling</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>10.3.4 Exercises</a></li>
<li class="chapter" data-level="10.2" data-path="function-factories.html"><a href="function-factories.html#factories-and-functionals"><i class="fa fa-check"></i><b>10.2</b> 10.5 factories and functionals</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>11</b> Function operators</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#introduction"><i class="fa fa-check"></i>11.1 Introduction</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#purrrsafely"><i class="fa fa-check"></i>11.2.1 purrr::safely</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#memoise"><i class="fa fa-check"></i>11.2.2 memoise</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>11.2.3.1 Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>12</b> Base Types</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#introduction"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="base-types.html"><a href="base-types.html#base-types-1"><i class="fa fa-check"></i>12.3 Base types</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>13</b> S3</a><ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#basics"><i class="fa fa-check"></i>13.2 Basics</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#classes"><i class="fa fa-check"></i>13.3 Classes</a><ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#ipa-helper"><i class="fa fa-check"></i>IPA Helper</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>13.3.4.3 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-1"><i class="fa fa-check"></i>13.3.4.4 Exercises</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#generics"><i class="fa fa-check"></i>13.4.1 Generics</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-2"><i class="fa fa-check"></i>13.4.4.5 Exercises</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i>13.5 Object styles</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#inheritance"><i class="fa fa-check"></i>13.6 Inheritance</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-3"><i class="fa fa-check"></i>13.4.3.3 Exercises</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#s3-and-base-types"><i class="fa fa-check"></i>13.7.1 S3 and Base Types</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i>13.7.3 Internal Generics</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i>13.7.4 Double Dispatch</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>14</b> R6</a><ul>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#classes-and-methods"><i class="fa fa-check"></i>14.2 Classes and methods</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#important-methods"><i class="fa fa-check"></i>14.2.2 Important methods</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#classes-and-methods-14.2.3"><i class="fa fa-check"></i>Classes and methods 14.2.3</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#exercises-14.2.6.4"><i class="fa fa-check"></i>Exercises 14.2.6.4</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#reference-semantics"><i class="fa fa-check"></i>14.4 Reference semantics</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a><ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#basics"><i class="fa fa-check"></i>15.2 Basics</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>15.3.6.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#signature"><i class="fa fa-check"></i>Signature</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i>15.5.1 Single dispatch</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="trade-offs.html"><a href="trade-offs.html"><i class="fa fa-check"></i><b>16</b> Trade-Offs</a><ul>
<li class="chapter" data-level="16.0.1" data-path="trade-offs.html"><a href="trade-offs.html#using-our-example-from-the-s4-chapter"><i class="fa fa-check"></i><b>16.0.1</b> Using our example from the S4 Chapter:</a></li>
<li class="chapter" data-level="" data-path="trade-offs.html"><a href="trade-offs.html#we-can-do-this-with-s3"><i class="fa fa-check"></i>We can do this with S3:</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="big-picture.html"><a href="big-picture.html"><i class="fa fa-check"></i><b>17</b> 17 Big Picture</a><ul>
<li class="chapter" data-level="" data-path="big-picture.html"><a href="big-picture.html#quosures"><i class="fa fa-check"></i>17.8 Quosures</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="expressions.html"><a href="expressions.html"><i class="fa fa-check"></i><b>18</b> Expressions</a></li>
<li class="chapter" data-level="19" data-path="quasiquotation.html"><a href="quasiquotation.html"><i class="fa fa-check"></i><b>19</b> Quasiquotation</a><ul>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#motivation"><i class="fa fa-check"></i>19.2 Motivation</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#substitution"><i class="fa fa-check"></i>19.3.4 Substitution</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#exercises-19.3.6.5"><i class="fa fa-check"></i>Exercises 19.3.6.5</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#polite-fiction-of"><i class="fa fa-check"></i>19.4.6 Polite fiction of !!</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#nonstandard-asts"><i class="fa fa-check"></i>19.4.7 Nonstandard ASTs</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>19.4.8.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#non-quoting"><i class="fa fa-check"></i>Non-quoting</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#section"><i class="fa fa-check"></i>19.6 (…)</a></li>
<li><a href="quasiquotation.html#exec">19.6.2 <code>exec()</code></a></li>
<li><a href="quasiquotation.html#dots_list">19.6.3 <code>dots_list()</code></a></li>
<li class="chapter" data-level="" data-path="quasiquotation.html"><a href="quasiquotation.html#with-base-r"><i class="fa fa-check"></i>19.6.4 With base R</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="evaluation.html"><a href="evaluation.html"><i class="fa fa-check"></i><b>20</b> Evaluation</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#introduction"><i class="fa fa-check"></i>20.1 Introduction</a></li>
<li><a href="evaluation.html#local">20.2.1 <code>local</code></a></li>
<li><a href="evaluation.html#source">20.2.2 <code>source</code></a></li>
<li><a href="evaluation.html#function">20.2.3 <code>function</code></a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>20.2.4.5 Exercises</a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#dots"><i class="fa fa-check"></i>20.3.3 Dots</a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#under-the-hood"><i class="fa fa-check"></i>20.3.4 Under the hood</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-1"><i class="fa fa-check"></i>20.3.6.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#basics"><i class="fa fa-check"></i>20.4.1 Basics</a></li>
<li><a href="evaluation.html#subset">20.4.3 <code>subset</code></a></li>
<li><a href="evaluation.html#transform">20.4.5 <code>transform</code></a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#handling-ambiguity"><i class="fa fa-check"></i>20.5.2 Handling ambiguity</a></li>
<li class="chapter" data-level="" data-path="evaluation.html"><a href="evaluation.html#substitute"><i class="fa fa-check"></i>20.6.1 substitute()</a></li>
<li><a href="evaluation.html#match.call">20.6.2 <code>match.call</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R Companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="r6" class="section level1">
<h1><span class="header-section-number">Chapter 14</span> R6</h1>
<div id="classes-and-methods" class="section level2 unnumbered">
<h2>14.2 Classes and methods</h2>
<div class="question">
<blockquote>
<p>Any … R6 method called for its side effects … should return invisible(self).</p>
</blockquote>
<p>WHY? What is <code>invisible(self)</code> doing in the add function below? I tried removing this line but it doesn’t change the output…</p>
</div>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb593-1" data-line-number="1">Accumulator &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;Accumulator&quot;</span>, <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb593-2" data-line-number="2">  <span class="dt">sum =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb593-3" data-line-number="3">  <span class="dt">add =</span> <span class="cf">function</span>(<span class="dt">x =</span> <span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb593-4" data-line-number="4">    self<span class="op">$</span>sum &lt;-<span class="st"> </span>self<span class="op">$</span>sum <span class="op">+</span><span class="st"> </span>x </a>
<a class="sourceLine" id="cb593-5" data-line-number="5">    <span class="kw">invisible</span>(self)</a>
<a class="sourceLine" id="cb593-6" data-line-number="6">  })</a>
<a class="sourceLine" id="cb593-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb593-8" data-line-number="8"></a>
<a class="sourceLine" id="cb593-9" data-line-number="9">x &lt;-<span class="st"> </span>Accumulator<span class="op">$</span><span class="kw">new</span>()</a></code></pre></div>
<p>Returning <code>self</code> or <code>invisible(self)</code> allows for method chaining. i.e. <code>x$add(1)$add(2)</code> can be done rather than <code>x$add(1); x$add(2)</code>. In the absence of anything better to return, why not return itself</p>
</div>
<div id="important-methods" class="section level2 unnumbered">
<h2>14.2.2 Important methods</h2>
<div class="question">
<p>Why don’t we need to specifically call <code>haldey2$print</code> to see the output below)? Is the print method just a built in output of an <code>R6</code> object?</p>
</div>
<div class="sourceCode" id="cb594"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb594-1" data-line-number="1">Person &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;Person&quot;</span>, <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb594-2" data-line-number="2">  <span class="dt">name =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb594-3" data-line-number="3">  <span class="dt">age =</span> <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb594-4" data-line-number="4">  <span class="dt">initialize =</span> <span class="cf">function</span>(name, <span class="dt">age =</span> <span class="ot">NA</span>) {</a>
<a class="sourceLine" id="cb594-5" data-line-number="5">    self<span class="op">$</span>name &lt;-<span class="st"> </span>name</a>
<a class="sourceLine" id="cb594-6" data-line-number="6">    self<span class="op">$</span>age &lt;-<span class="st"> </span>age</a>
<a class="sourceLine" id="cb594-7" data-line-number="7">  },</a>
<a class="sourceLine" id="cb594-8" data-line-number="8">  <span class="dt">print =</span> <span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb594-9" data-line-number="9">    <span class="kw">cat</span>(<span class="st">&quot;Person: </span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb594-10" data-line-number="10">    <span class="kw">cat</span>(<span class="st">&quot;  Name: &quot;</span>, self<span class="op">$</span>name, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb594-11" data-line-number="11">    <span class="kw">cat</span>(<span class="st">&quot;  Age:  &quot;</span>, self<span class="op">$</span>age, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb594-12" data-line-number="12">    <span class="kw">invisible</span>(self)</a>
<a class="sourceLine" id="cb594-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb594-14" data-line-number="14">))</a>
<a class="sourceLine" id="cb594-15" data-line-number="15"></a>
<a class="sourceLine" id="cb594-16" data-line-number="16">hadley2 &lt;-<span class="st"> </span>Person<span class="op">$</span><span class="kw">new</span>(<span class="st">&quot;Hadley&quot;</span>)</a>
<a class="sourceLine" id="cb594-17" data-line-number="17">hadley2</a></code></pre></div>
<pre><code>Person: 
  Name: Hadley
  Age:  NA</code></pre>
<p>Print is an S3 generic, so when print is implicitly called, it calls the method for the R6 object. The method for the R6 object is “look for a print function inside the R6 object”</p>
</div>
<div id="classes-and-methods-14.2.3" class="section level2 unnumbered">
<h2>Classes and methods 14.2.3</h2>
<div class="question">
<p>Once instantiated, can you add another method to an <code>R6</code> object or does the <code>set</code> function only work on the <code>R6</code> generator?</p>
</div>
<p>Once instantiated the environments are locked (no new bindings). But, you can fudge with things and still modify existing bindings if you wanted. But, this is not really something to advocate:</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb596-1" data-line-number="1">Beer &lt;-<span class="st"> </span>R6<span class="op">::</span><span class="kw">R6Class</span>(</a>
<a class="sourceLine" id="cb596-2" data-line-number="2">  <span class="st">&#39;Beer&#39;</span>,</a>
<a class="sourceLine" id="cb596-3" data-line-number="3">  <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb596-4" data-line-number="4">    <span class="dt">abv =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb596-5" data-line-number="5">    <span class="dt">percent_abv =</span> <span class="cf">function</span>() { <span class="kw">sprintf</span>(<span class="st">&#39;%.1f%%&#39;</span>, <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>self<span class="op">$</span>abv) }</a>
<a class="sourceLine" id="cb596-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb596-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb596-8" data-line-number="8"><span class="kw">class</span>(Beer)</a>
<a class="sourceLine" id="cb596-9" data-line-number="9"><span class="co">#&gt; [1] &quot;R6ClassGenerator&quot;</span></a>
<a class="sourceLine" id="cb596-10" data-line-number="10">beer &lt;-<span class="st"> </span>Beer<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb596-11" data-line-number="11"><span class="kw">unlockBinding</span>(<span class="st">&quot;percent_abv&quot;</span>, beer)</a>
<a class="sourceLine" id="cb596-12" data-line-number="12">beer<span class="op">$</span>percent_abv &lt;-<span class="st"> </span><span class="cf">function</span>() { <span class="kw">cat</span>(<span class="st">&quot;h@xed&quot;</span>)}</a>
<a class="sourceLine" id="cb596-13" data-line-number="13"><span class="kw">lockBinding</span>(<span class="st">&quot;percent_abv&quot;</span>, beer)</a>
<a class="sourceLine" id="cb596-14" data-line-number="14">beer<span class="op">$</span><span class="kw">percent_abv</span>()</a></code></pre></div>
<pre><code>[1] &quot;R6ClassGenerator&quot;
h@xed</code></pre>
<p>You can also set the lock_objects option on the generator to FALSE</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb598-1" data-line-number="1">Beer &lt;-<span class="st"> </span>R6<span class="op">::</span><span class="kw">R6Class</span>(</a>
<a class="sourceLine" id="cb598-2" data-line-number="2">  <span class="st">&#39;Beer&#39;</span>,</a>
<a class="sourceLine" id="cb598-3" data-line-number="3">  <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb598-4" data-line-number="4">    <span class="dt">abv =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb598-5" data-line-number="5">    <span class="dt">percent_abv =</span> <span class="cf">function</span>() { <span class="kw">sprintf</span>(<span class="st">&#39;%.1f%%&#39;</span>, <span class="dv">100</span> <span class="op">*</span><span class="st"> </span>self<span class="op">$</span>abv) }</a>
<a class="sourceLine" id="cb598-6" data-line-number="6">  ),</a>
<a class="sourceLine" id="cb598-7" data-line-number="7">  <span class="dt">lock_objects =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb598-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb598-9" data-line-number="9">beer &lt;-<span class="st"> </span>Beer<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb598-10" data-line-number="10">beer<span class="op">$</span>rating &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb598-11" data-line-number="11">beer<span class="op">$</span>rating</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<pre><code>[1] 5</code></pre>
<p>But this still won’t work because the bindings were still locked</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb601-1" data-line-number="1">beer<span class="op">$</span>percent_abv &lt;-<span class="st"> </span><span class="cf">function</span>() { <span class="kw">cat</span>(<span class="st">&quot;h@xed&quot;</span>)}</a></code></pre></div>
<pre><code>#&gt; Error in beer$percent_abv &lt;- function() {: cannot change value of locked binding for &#39;percent_abv&#39;</code></pre>
</div>
<div id="exercises-14.2.6.4" class="section level2 unnumbered">
<h2>Exercises 14.2.6.4</h2>
<div class="question">
<p>Why can’t we use method chaining to access the current time zone?</p>
</div>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" data-line-number="1">Timezone &lt;-<span class="st"> </span><span class="kw">R6Class</span>(</a>
<a class="sourceLine" id="cb603-2" data-line-number="2">  <span class="dt">classname =</span> <span class="st">&quot;Timezone&quot;</span>, </a>
<a class="sourceLine" id="cb603-3" data-line-number="3">  <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb603-4" data-line-number="4">    <span class="dt">get =</span> <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb603-5" data-line-number="5">      <span class="kw">Sys.timezone</span>()</a>
<a class="sourceLine" id="cb603-6" data-line-number="6">    },</a>
<a class="sourceLine" id="cb603-7" data-line-number="7">    <span class="dt">set =</span> <span class="cf">function</span>(value) {</a>
<a class="sourceLine" id="cb603-8" data-line-number="8">      <span class="kw">stopifnot</span>(value <span class="op">%in%</span><span class="st"> </span><span class="kw">OlsonNames</span>())</a>
<a class="sourceLine" id="cb603-9" data-line-number="9">      </a>
<a class="sourceLine" id="cb603-10" data-line-number="10">      old &lt;-<span class="st"> </span>self<span class="op">$</span><span class="kw">get</span>()</a>
<a class="sourceLine" id="cb603-11" data-line-number="11">      <span class="kw">Sys.setenv</span>(<span class="dt">TZ =</span> value)</a>
<a class="sourceLine" id="cb603-12" data-line-number="12">      <span class="kw">invisible</span>(old)</a>
<a class="sourceLine" id="cb603-13" data-line-number="13">    })</a>
<a class="sourceLine" id="cb603-14" data-line-number="14">)</a>
<a class="sourceLine" id="cb603-15" data-line-number="15"></a>
<a class="sourceLine" id="cb603-16" data-line-number="16">tz &lt;-<span class="st"> </span>Timezone<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb603-17" data-line-number="17"></a>
<a class="sourceLine" id="cb603-18" data-line-number="18">old &lt;-<span class="st"> </span>tz<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;Antarctica/South_Pole&quot;</span>)</a>
<a class="sourceLine" id="cb603-19" data-line-number="19">tz<span class="op">$</span><span class="kw">get</span>()</a></code></pre></div>
<pre><code>[1] &quot;America/Los_Angeles&quot;</code></pre>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" data-line-number="1">tz<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;Antarctica/South_Pole&quot;</span>)<span class="op">$</span><span class="kw">get</span>()</a></code></pre></div>
<pre><code>Error in tz$set(&quot;Antarctica/South_Pole&quot;)$get : 
  $ operator is invalid for atomic vectors</code></pre>
<p>You’re not returning an R6 object in your first “set”, you’re returning a character vector, so you can’t find the get method of that character vector</p>
<p>We can return something using the following code:</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb607-1" data-line-number="1">Timezone &lt;-<span class="st"> </span><span class="kw">R6Class</span>(</a>
<a class="sourceLine" id="cb607-2" data-line-number="2">  <span class="dt">classname =</span> <span class="st">&quot;Timezone&quot;</span>, </a>
<a class="sourceLine" id="cb607-3" data-line-number="3">  <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb607-4" data-line-number="4">    <span class="dt">get =</span> <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb607-5" data-line-number="5">      self<span class="op">$</span>current_zone</a>
<a class="sourceLine" id="cb607-6" data-line-number="6">    },</a>
<a class="sourceLine" id="cb607-7" data-line-number="7">    <span class="dt">set =</span> <span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb607-8" data-line-number="8">      self<span class="op">$</span>current_zone &lt;-<span class="st"> </span>v</a>
<a class="sourceLine" id="cb607-9" data-line-number="9">      <span class="kw">invisible</span>(self)</a>
<a class="sourceLine" id="cb607-10" data-line-number="10">    },</a>
<a class="sourceLine" id="cb607-11" data-line-number="11">    <span class="dt">reset =</span> <span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb607-12" data-line-number="12">      <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.null</span>(private<span class="op">$</span>.old)) {</a>
<a class="sourceLine" id="cb607-13" data-line-number="13">        self<span class="op">$</span>current_zone &lt;-<span class="st"> </span>private<span class="op">$</span>.old</a>
<a class="sourceLine" id="cb607-14" data-line-number="14">      }</a>
<a class="sourceLine" id="cb607-15" data-line-number="15">      <span class="kw">invisible</span>(self)</a>
<a class="sourceLine" id="cb607-16" data-line-number="16">    }</a>
<a class="sourceLine" id="cb607-17" data-line-number="17">  ),</a>
<a class="sourceLine" id="cb607-18" data-line-number="18">  <span class="dt">active =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb607-19" data-line-number="19">    <span class="dt">current_zone =</span> <span class="cf">function</span>(v) {</a>
<a class="sourceLine" id="cb607-20" data-line-number="20">      <span class="cf">if</span> (<span class="kw">missing</span>(v)) {</a>
<a class="sourceLine" id="cb607-21" data-line-number="21">        <span class="kw">return</span>(<span class="kw">Sys.timezone</span>())</a>
<a class="sourceLine" id="cb607-22" data-line-number="22">      }</a>
<a class="sourceLine" id="cb607-23" data-line-number="23">      <span class="kw">stopifnot</span>(v <span class="op">%in%</span><span class="st"> </span><span class="kw">OlsonNames</span>())</a>
<a class="sourceLine" id="cb607-24" data-line-number="24">      old &lt;-<span class="st"> </span><span class="kw">Sys.timezone</span>()</a>
<a class="sourceLine" id="cb607-25" data-line-number="25">      <span class="cf">if</span> (<span class="kw">Sys.setenv</span>(<span class="dt">TZ=</span>v)) {</a>
<a class="sourceLine" id="cb607-26" data-line-number="26">        private<span class="op">$</span>.old &lt;-<span class="st"> </span>old</a>
<a class="sourceLine" id="cb607-27" data-line-number="27">      } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb607-28" data-line-number="28">        <span class="kw">stop</span>(<span class="st">&quot;Unable to set timezone.&quot;</span>)</a>
<a class="sourceLine" id="cb607-29" data-line-number="29">      }</a>
<a class="sourceLine" id="cb607-30" data-line-number="30">      <span class="kw">invisible</span>(self)</a>
<a class="sourceLine" id="cb607-31" data-line-number="31">    }</a>
<a class="sourceLine" id="cb607-32" data-line-number="32">  ),</a>
<a class="sourceLine" id="cb607-33" data-line-number="33">  <span class="dt">private =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb607-34" data-line-number="34">    <span class="dt">.old =</span> <span class="ot">NULL</span></a>
<a class="sourceLine" id="cb607-35" data-line-number="35">  )</a>
<a class="sourceLine" id="cb607-36" data-line-number="36">)</a>
<a class="sourceLine" id="cb607-37" data-line-number="37">tz &lt;-<span class="st"> </span>Timezone<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb607-38" data-line-number="38">tz<span class="op">$</span><span class="kw">set</span>(<span class="st">&quot;Antarctica/South_Pole&quot;</span>)<span class="op">$</span><span class="kw">get</span>()</a>
<a class="sourceLine" id="cb607-39" data-line-number="39"><span class="co">#&gt; [1] &quot;Antarctica/South_Pole&quot;</span></a>
<a class="sourceLine" id="cb607-40" data-line-number="40">tz<span class="op">$</span><span class="kw">reset</span>()<span class="op">$</span><span class="kw">get</span>()</a>
<a class="sourceLine" id="cb607-41" data-line-number="41"><span class="co">#&gt; [1] &quot;US/Central&quot;</span></a></code></pre></div>
<p>That said, not every function should support chaining. Sometimes you want the function to return some value (like <code>$get</code>) and in these cases, you just won’t be able to chain, and that is okay.</p>
</div>
<div id="reference-semantics" class="section level2 unnumbered">
<h2>14.4 Reference semantics</h2>
<div class="question">
<blockquote>
<p>$clone() does not recursively clone nested R6 objects. If you want that, you’ll need to use $clone(deep = TRUE).</p>
</blockquote>
<p>Can we see this in action using a subclass?</p>
</div>
<div id="this-example-is-taken-from-the-r6-documentation" class="section level4 unnumbered">
<h4>This example is taken from the <code>R6</code> <a href="https://r6.r-lib.org/articles/Introduction.html">documentation</a>:</h4>
<p>Object <code>c1</code> contains <code>s</code>, which we will clone. The original and clone both point to the same object, and by using <code>deep = TRUE</code> we can modify <code>s</code> in one object without changing it in the other.</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb608-1" data-line-number="1">Simple &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;Simple&quot;</span>, <span class="dt">public =</span> <span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb608-2" data-line-number="2"></a>
<a class="sourceLine" id="cb608-3" data-line-number="3">Cloneable &lt;-<span class="st"> </span><span class="kw">R6Class</span>(<span class="st">&quot;Cloneable&quot;</span>,</a>
<a class="sourceLine" id="cb608-4" data-line-number="4">  <span class="dt">public =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb608-5" data-line-number="5">    <span class="dt">s =</span> <span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb608-6" data-line-number="6">    <span class="dt">initialize =</span> <span class="cf">function</span>() self<span class="op">$</span>s &lt;-<span class="st"> </span>Simple<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb608-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb608-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb608-9" data-line-number="9"></a>
<a class="sourceLine" id="cb608-10" data-line-number="10">c1 &lt;-<span class="st"> </span>Cloneable<span class="op">$</span><span class="kw">new</span>()</a>
<a class="sourceLine" id="cb608-11" data-line-number="11">c2 &lt;-<span class="st"> </span>c1<span class="op">$</span><span class="kw">clone</span>()</a>
<a class="sourceLine" id="cb608-12" data-line-number="12"></a>
<a class="sourceLine" id="cb608-13" data-line-number="13"><span class="co"># Change c1&#39;s `s` field</span></a>
<a class="sourceLine" id="cb608-14" data-line-number="14">c1<span class="op">$</span>s<span class="op">$</span>x &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb608-15" data-line-number="15"></a>
<a class="sourceLine" id="cb608-16" data-line-number="16"><span class="co"># c2&#39;s `s` is the same object, so it reflects the change</span></a>
<a class="sourceLine" id="cb608-17" data-line-number="17">c2<span class="op">$</span>s<span class="op">$</span>x</a>
<a class="sourceLine" id="cb608-18" data-line-number="18"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb608-19" data-line-number="19"></a>
<a class="sourceLine" id="cb608-20" data-line-number="20">c3 &lt;-<span class="st"> </span>c1<span class="op">$</span><span class="kw">clone</span>(<span class="dt">deep =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb608-21" data-line-number="21"></a>
<a class="sourceLine" id="cb608-22" data-line-number="22"><span class="co"># Change c1&#39;s `s` field</span></a>
<a class="sourceLine" id="cb608-23" data-line-number="23">c1<span class="op">$</span>s<span class="op">$</span>x &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb608-24" data-line-number="24"></a>
<a class="sourceLine" id="cb608-25" data-line-number="25"><span class="co"># c2&#39;s `s` is different</span></a>
<a class="sourceLine" id="cb608-26" data-line-number="26"><span class="co"># if we set deep = FALSE this would be 3!</span></a>
<a class="sourceLine" id="cb608-27" data-line-number="27">c3<span class="op">$</span>s<span class="op">$</span>x</a>
<a class="sourceLine" id="cb608-28" data-line-number="28"><span class="co">#&gt; [1] 2</span></a></code></pre></div>
<div class="question">
<p>When or why would I set the clone argument to FALSE?</p>
</div>
<p>Clone has a large memory footprint so if you’re going to create a lot of R6 methods you may want to exclude this!</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="s3.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="s4.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/14-R6.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["AdvancedR_Companion.pdf", "AdvancedR_Companion.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
