<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Function operators | Advanced R Companion</title>
  <meta name="description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Function operators | Advanced R Companion" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Function operators | Advanced R Companion" />
  
  <meta name="twitter:description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  

<meta name="author" content="R4DS Reading Group" />


<meta name="date" content="2020-07-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="function-factories.html"/>
<link rel="next" href="base-types.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<img src="images/r4ds.png" style="width:300px;height:180px;padding-bottom:0px;"></img>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="welcome.html"><a href="welcome.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="names-and-values.html"><a href="names-and-values.html"><i class="fa fa-check"></i><b>2</b> Names and Values</a><ul>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#binding-basics"><i class="fa fa-check"></i>2.2 Binding basics</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#copy-on-modify"><i class="fa fa-check"></i>2.3 Copy-on-modify</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>2.2.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#function-calls"><i class="fa fa-check"></i>2.3.2 Function calls</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#lists"><i class="fa fa-check"></i>2.3.3 Lists</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#character-vectors"><i class="fa fa-check"></i>2.3.5 Character vectors</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercise"><i class="fa fa-check"></i>2.3.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#object-size"><i class="fa fa-check"></i>2.4.1 Object size</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#modify-in-place"><i class="fa fa-check"></i>2.5.1 Modify-in-place</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors.html"><a href="vectors.html"><i class="fa fa-check"></i><b>3</b> Vectors</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#scalars"><i class="fa fa-check"></i>3.2.1 Scalars</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#missing-values"><i class="fa fa-check"></i>3.2.3 Missing values</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#testing-and-coercion"><i class="fa fa-check"></i>3.2.4 Testing and coercion</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#setting-attributes"><i class="fa fa-check"></i>3.3.1 Setting Attributes</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#setnames"><i class="fa fa-check"></i>3.3.2 setNames</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#dimensions"><i class="fa fa-check"></i>3.3.3 Dimensions</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#s3-atomic-vectors"><i class="fa fa-check"></i>3.4 S3 atomic vectors</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#dates"><i class="fa fa-check"></i>3.4.2 Dates</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#lists-1"><i class="fa fa-check"></i>3.5.1 Lists</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#data-frames-and-tibbles"><i class="fa fa-check"></i>3.6.8 Data frames and tibbles</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#conclusion"><i class="fa fa-check"></i>Conclusion</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#vectorized"><i class="fa fa-check"></i>VECTORIZED:</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#non-vectorized"><i class="fa fa-check"></i>NON-VECTORIZED:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#introduction"><i class="fa fa-check"></i>4.1 Introduction</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#selecting-multiple-elements"><i class="fa fa-check"></i>4.2.1 Selecting multiple elements</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#lists-2"><i class="fa fa-check"></i>4.2.2 lists</a></li>
<li><a href="subsetting.html#section">4.3.1 <code>[[</code></a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#exercise-1"><i class="fa fa-check"></i>4.3.5 Exercise</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#missing-and-oob"><i class="fa fa-check"></i>4.3.3 Missing and OOB</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#logical-atomic"><i class="fa fa-check"></i>LOGICAL ATOMIC</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#list"><i class="fa fa-check"></i>LIST</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#null"><i class="fa fa-check"></i>NULL</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#logical-subsetting"><i class="fa fa-check"></i>4.5.8 Logical subsetting</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra"><i class="fa fa-check"></i>4.5.8 Boolean algebra</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-flow.html"><a href="control-flow.html"><i class="fa fa-check"></i><b>5</b> Control Flow</a><ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#vectorised-if"><i class="fa fa-check"></i>5.2.2 Vectorised if</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#loops"><i class="fa fa-check"></i>5.3 Loops</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#switch-statement"><i class="fa fa-check"></i>5.2.3 switch statement</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#common-pitfalls"><i class="fa fa-check"></i>5.3.1 common pitfalls</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#exercises-1"><i class="fa fa-check"></i>5.3.3.1 Exercises</a><ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#assignment-to-a-valid-index"><i class="fa fa-check"></i>Assignment to a valid index</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#assignment-to-0"><i class="fa fa-check"></i>Assignment to [0]</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#empty-index"><i class="fa fa-check"></i>Empty index</a></li>
<li><a href="control-flow.html#impossible-index">Impossible Index <code>[[</code></a></li>
<li><a href="control-flow.html#impossible-index--">Impossible Index <code>[[&lt;-</code></a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#undefined-name"><i class="fa fa-check"></i>Undefined name</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#out-of-bounds"><i class="fa fa-check"></i>Out of Bounds</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#conclusion-1"><i class="fa fa-check"></i>Conclusion</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#complexity"><i class="fa fa-check"></i>Complexity</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#primitives"><i class="fa fa-check"></i>6.2.2 Primitives</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercises-2"><i class="fa fa-check"></i>6.2.5.1 Exercises</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i>6.3 Function composition</a><ul>
<li class="chapter" data-level="6.0.1" data-path="functions.html"><a href="functions.html#nested"><i class="fa fa-check"></i><b>6.0.1</b> Nested</a></li>
<li class="chapter" data-level="6.0.2" data-path="functions.html"><a href="functions.html#intermediate"><i class="fa fa-check"></i><b>6.0.2</b> Intermediate</a></li>
<li class="chapter" data-level="6.0.3" data-path="functions.html"><a href="functions.html#piping"><i class="fa fa-check"></i><b>6.0.3</b> Piping</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i>6.4 Lexical scoping</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#a-fresh-start"><i class="fa fa-check"></i>6.4.3 A fresh start</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i>6.5 Lazy evaluation</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i>6.5.1 Promises</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i>6.5.2 Default arguments</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-2"><i class="fa fa-check"></i>6.5.4.3 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-3"><i class="fa fa-check"></i>6.5.4.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#dot-dot-dot"><i class="fa fa-check"></i>6.6 dot dot dot</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-4"><i class="fa fa-check"></i>6.6.1.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exit-handlers"><i class="fa fa-check"></i>6.7.4 Exit handlers</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-5"><i class="fa fa-check"></i>6.7.5.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-6"><i class="fa fa-check"></i>6.7.5.5 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i>6.8.4 Replacement functions</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-7"><i class="fa fa-check"></i>6.8.6.3 Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a><ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i>7.2.3 Parents</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#super-assignment"><i class="fa fa-check"></i>7.2.4 Super assignment</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#getting-and-setting"><i class="fa fa-check"></i>7.2.5 Getting and setting</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i>7.2.6 Advanced bindings</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#recursing-over-environments"><i class="fa fa-check"></i>7.3 Recursing over environments</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#exercises-3"><i class="fa fa-check"></i>7.3.1.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#function-enviornment"><i class="fa fa-check"></i>7.4.2 Function enviornment</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i>7.4.3 Namespaces</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#call-stacks"><i class="fa fa-check"></i>7.5 Call stacks</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#data-structures"><i class="fa fa-check"></i>7.6 Data Structures</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a><ul>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i>8.3 Ignoring conditions</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i>8.4.2 Exiting handlers</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i>8.4.3 Calling handlers</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-4"><i class="fa fa-check"></i>8.4.5.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-5"><i class="fa fa-check"></i>8.4.5.3 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i>8.6.3 Resignal</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i>8.6.4 Record</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-6"><i class="fa fa-check"></i>8.6.6.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-7"><i class="fa fa-check"></i>8.6.6.4 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#slides"><i class="fa fa-check"></i>Slides</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a><ul>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#anonymous-functions-and-shortcuts"><i class="fa fa-check"></i>9.2.2 Anonymous functions and shortcuts</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-8"><i class="fa fa-check"></i>9.2.6.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-9"><i class="fa fa-check"></i>9.2.6.5 Exercise</a></li>
<li><a href="functionals.html#same-type-of-output-as-input-modify">9.4.1 Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#any-number-of-inputs-pmap-and-friends"><i class="fa fa-check"></i>9.4.5 Any number of inputs: pmap() and friends</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-10"><i class="fa fa-check"></i>9.4.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#multiple-inputs"><i class="fa fa-check"></i>9.5.4 Multiple inputs</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-11"><i class="fa fa-check"></i>9.6.3.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#matrices-and-arrays"><i class="fa fa-check"></i>9.7.1 Matrices and arrays</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-12"><i class="fa fa-check"></i>9.7.3.2 Exercise</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>10</b> Function factories</a><ul>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i>10.2 Factory fundamentals</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#forcing-evaluation"><i class="fa fa-check"></i>10.2.3 Forcing evaluation</a></li>
<li class="chapter" data-level="10.1" data-path="function-factories.html"><a href="function-factories.html#without-force"><i class="fa fa-check"></i><b>10.1</b> WITHOUT FORCE</a><ul>
<li class="chapter" data-level="10.1.1" data-path="function-factories.html"><a href="function-factories.html#using-force"><i class="fa fa-check"></i><b>10.1.1</b> USING FORCE</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#garbage-collection"><i class="fa fa-check"></i>10.2.5 garbage collection</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#exercise-13"><i class="fa fa-check"></i>10.2.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#exercise-14"><i class="fa fa-check"></i>10.2.6.3 Exercise</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i>10.3.1 Labelling</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#exercises-8"><i class="fa fa-check"></i>10.3.4 Exercises</a></li>
<li class="chapter" data-level="10.2" data-path="function-factories.html"><a href="function-factories.html#factories-and-functionals"><i class="fa fa-check"></i><b>10.2</b> 10.5 factories and functionals</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>11</b> Function operators</a><ul>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#introduction-1"><i class="fa fa-check"></i>11.1 Introduction</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#purrrsafely"><i class="fa fa-check"></i>11.2.1 purrr::safely</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#memoise"><i class="fa fa-check"></i>11.2.2 memoise</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#exercises-9"><i class="fa fa-check"></i>11.2.3.1 Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="base-types.html"><a href="base-types.html"><i class="fa fa-check"></i><b>12</b> Base Types</a><ul>
<li class="chapter" data-level="" data-path="base-types.html"><a href="base-types.html#introduction-2"><i class="fa fa-check"></i>Introduction</a></li>
<li class="chapter" data-level="" data-path="base-types.html"><a href="base-types.html#base-types-1"><i class="fa fa-check"></i>12.3 Base types</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="s3.html"><a href="s3.html"><i class="fa fa-check"></i><b>13</b> S3</a><ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#basics"><i class="fa fa-check"></i>13.2 Basics</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#classes"><i class="fa fa-check"></i>13.3 Classes</a><ul>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#ipa-helper"><i class="fa fa-check"></i>IPA Helper</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#exercises-10"><i class="fa fa-check"></i>13.3.4.3 Exercises</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#exercises-11"><i class="fa fa-check"></i>13.3.4.4 Exercises</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#generics"><i class="fa fa-check"></i>13.4.1 Generics</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#exercises-12"><i class="fa fa-check"></i>13.4.4.5 Exercises</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#object-styles"><i class="fa fa-check"></i>13.5 Object styles</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#inheritance"><i class="fa fa-check"></i>13.6 Inheritance</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#exercises-13"><i class="fa fa-check"></i>13.4.3.3 Exercises</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#s3-and-base-types"><i class="fa fa-check"></i>13.7.1 S3 and Base Types</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#internal-generics"><i class="fa fa-check"></i>13.7.3 Internal Generics</a></li>
<li class="chapter" data-level="" data-path="s3.html"><a href="s3.html#double-dispatch"><i class="fa fa-check"></i>13.7.4 Double Dispatch</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="r6.html"><a href="r6.html"><i class="fa fa-check"></i><b>14</b> R6</a><ul>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#classes-and-methods"><i class="fa fa-check"></i>14.2 Classes and methods</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#important-methods"><i class="fa fa-check"></i>14.2.2 Important methods</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#classes-and-methods-14.2.3"><i class="fa fa-check"></i>Classes and methods 14.2.3</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#exercises-14.2.6.4"><i class="fa fa-check"></i>Exercises 14.2.6.4</a></li>
<li class="chapter" data-level="" data-path="r6.html"><a href="r6.html#reference-semantics"><i class="fa fa-check"></i>14.4 Reference semantics</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="s4.html"><a href="s4.html"><i class="fa fa-check"></i><b>15</b> S4</a><ul>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#basics-1"><i class="fa fa-check"></i>15.2 Basics</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#exercises-14"><i class="fa fa-check"></i>15.3.6.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#signature"><i class="fa fa-check"></i>Signature</a></li>
<li class="chapter" data-level="" data-path="s4.html"><a href="s4.html#single-dispatch"><i class="fa fa-check"></i>15.5.1 Single dispatch</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="trade-offs.html"><a href="trade-offs.html"><i class="fa fa-check"></i><b>16</b> Trade-Offs</a><ul>
<li class="chapter" data-level="16.0.1" data-path="trade-offs.html"><a href="trade-offs.html#using-our-example-from-the-s4-chapter"><i class="fa fa-check"></i><b>16.0.1</b> Using our example from the S4 Chapter:</a></li>
<li class="chapter" data-level="" data-path="trade-offs.html"><a href="trade-offs.html#we-can-do-this-with-s3"><i class="fa fa-check"></i>We can do this with S3:</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="big-picture.html"><a href="big-picture.html"><i class="fa fa-check"></i><b>17</b> 17 Big Picture</a><ul>
<li class="chapter" data-level="" data-path="big-picture.html"><a href="big-picture.html#quosures"><i class="fa fa-check"></i>17.8 Quosures</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R Companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="function-operators" class="section level1">
<h1><span class="header-section-number">Chapter 11</span> Function operators</h1>
<div id="introduction-1" class="section level2 unnumbered">
<h2>11.1 Introduction</h2>
<div class="question">
<blockquote>
<p>A function operator is a function that takes one (or more) functions as input and returns a function as output</p>
</blockquote>
<p>…How exactly does this definition differ from a function factory?</p>
</div>
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#oypscdwien .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oypscdwien .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oypscdwien .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oypscdwien .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 4px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oypscdwien .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oypscdwien .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oypscdwien .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oypscdwien .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oypscdwien .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oypscdwien .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oypscdwien .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oypscdwien .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#oypscdwien .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oypscdwien .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oypscdwien .gt_from_md > :first-child {
  margin-top: 0;
}

#oypscdwien .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oypscdwien .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oypscdwien .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#oypscdwien .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oypscdwien .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#oypscdwien .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oypscdwien .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oypscdwien .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oypscdwien .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oypscdwien .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#oypscdwien .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oypscdwien .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#oypscdwien .gt_left {
  text-align: left;
}

#oypscdwien .gt_center {
  text-align: center;
}

#oypscdwien .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oypscdwien .gt_font_normal {
  font-weight: normal;
}

#oypscdwien .gt_font_bold {
  font-weight: bold;
}

#oypscdwien .gt_font_italic {
  font-style: italic;
}

#oypscdwien .gt_super {
  font-size: 65%;
}

#oypscdwien .gt_footnote_marks {
  font-style: italic;
  font-size: 65%;
}
</style>
<div id="oypscdwien" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;"><table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Term</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Required Input</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Optional Output</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">Output</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr>
      <td class="gt_row gt_left">Functionals</td>
      <td class="gt_row gt_left">Function</td>
      <td class="gt_row gt_left">Vector</td>
      <td class="gt_row gt_left">Vector</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Function Factory</td>
      <td class="gt_row gt_left">NA</td>
      <td class="gt_row gt_left">Vector,Function</td>
      <td class="gt_row gt_left">Function</td>
    </tr>
    <tr>
      <td class="gt_row gt_left">Function Operator</td>
      <td class="gt_row gt_left">Function</td>
      <td class="gt_row gt_left">Function</td>
      <td class="gt_row gt_left">Function</td>
    </tr>
  </tbody>
  
  
</table></div>
<blockquote>
<p>Function operators are closely related to function factories; indeed they’re just a function factory that takes a function as input</p>
</blockquote>
<div class="question">
<p>Can anyone confirm that, by definition, function operators can only take functions as inputs (and not any kind of vector)? Book quote: “A function operator is a function that takes one (or more) functions as input and returns a function as output.” If this is true, then something like the following would only be a function factory, not both a function factory and a function operator:</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" data-line-number="1">sleepy &lt;-<span class="st"> </span><span class="cf">function</span>(f, n){</a>
<a class="sourceLine" id="cb498-2" data-line-number="2">  <span class="kw">force</span>(f)</a>
<a class="sourceLine" id="cb498-3" data-line-number="3">  <span class="cf">function</span>(...){</a>
<a class="sourceLine" id="cb498-4" data-line-number="4">    <span class="kw">cat</span>(</a>
<a class="sourceLine" id="cb498-5" data-line-number="5">      glue<span class="op">::</span><span class="kw">glue</span>(<span class="st">&#39;Sleeping for {n} second{ifelse(n != 1, &quot;s&quot;, &quot;&quot;)}.&#39;</span>), </a>
<a class="sourceLine" id="cb498-6" data-line-number="6">      <span class="dt">sep =</span> <span class="st">&#39;</span><span class="ch">\n</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb498-7" data-line-number="7">    )</a>
<a class="sourceLine" id="cb498-8" data-line-number="8">    <span class="kw">Sys.sleep</span>(n)</a>
<a class="sourceLine" id="cb498-9" data-line-number="9">    <span class="kw">f</span>(...)</a>
<a class="sourceLine" id="cb498-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb498-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb498-12" data-line-number="12"></a>
<a class="sourceLine" id="cb498-13" data-line-number="13">sleepy_print &lt;-<span class="st"> </span><span class="kw">sleepy</span>(print, <span class="fl">1.5</span>)</a>
<a class="sourceLine" id="cb498-14" data-line-number="14"><span class="kw">sleepy_print</span>(<span class="st">&#39;hello world&#39;</span>)</a></code></pre></div>
<pre><code>## Sleeping for 1.5 seconds.
## [1] &quot;hello world&quot;</code></pre>
</div>
<p>Function factories are “any function that returns a function” and Hadley uses “simple” examples where you pass in a numeric or character to get back a customized function (pass a number to a power function to get a function dedicated to cubes)</p>
<p>Function operators are factories where you pass in a function and modify its behaviour a little, without actually building up the logic for a function from scratch. The operator does not supply the actual meat of the logic.
examples: <code>safely</code>, <code>silently</code>, <code>rate-limity</code> etc</p>
</div>
<div id="purrrsafely" class="section level2 unnumbered">
<h2>11.2.1 purrr::safely</h2>
<div class="question">
<p>It seems like safely is a condition wrapper - are all conditions a kind of function operator?</p>
</div>
<p><code>safely</code>/<code>possibly</code>/<code>quietly</code> are function operators that are condition-wrappers, but <code>tryCatch</code>/<code>withCallingHandlers</code> are not function operators (they catch the outputs and do X thing but don’t actually return a function)</p>
<div class="question">
<p>How would we apply <code>safely</code> to find which dataframe in a list of dataframes is causing an error?</p>
</div>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb500-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb500-2" data-line-number="2"></a>
<a class="sourceLine" id="cb500-3" data-line-number="3">random_starwars &lt;-<span class="st"> </span><span class="cf">function</span>() { </a>
<a class="sourceLine" id="cb500-4" data-line-number="4">  starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb500-5" data-line-number="5"><span class="st">    </span><span class="kw">sample_n</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb500-6" data-line-number="6"><span class="st">    </span><span class="kw">select</span>(name, height,mass)</a>
<a class="sourceLine" id="cb500-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb500-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb500-9" data-line-number="9">broken_starwars &lt;-<span class="st"> </span><span class="cf">function</span>(){ </a>
<a class="sourceLine" id="cb500-10" data-line-number="10">  starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb500-11" data-line-number="11"><span class="st">  </span><span class="kw">sample_n</span>(<span class="dv">50</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb500-12" data-line-number="12"><span class="st">  </span><span class="kw">select</span>(name, height,mass) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb500-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height =</span> <span class="kw">as.character</span>(height))</a>
<a class="sourceLine" id="cb500-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb500-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb500-16" data-line-number="16">list_data &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="kw">random_starwars</span>(),</a>
<a class="sourceLine" id="cb500-17" data-line-number="17">                  <span class="dt">b =</span> <span class="kw">random_starwars</span>(),</a>
<a class="sourceLine" id="cb500-18" data-line-number="18">                  <span class="dt">c =</span> <span class="kw">broken_starwars</span>(),</a>
<a class="sourceLine" id="cb500-19" data-line-number="19">                  <span class="dt">d =</span> <span class="kw">random_starwars</span>())</a>
<a class="sourceLine" id="cb500-20" data-line-number="20"></a>
<a class="sourceLine" id="cb500-21" data-line-number="21">map_dfr_safely &lt;-<span class="st"> </span><span class="cf">function</span>(.x, .f, ... ) {</a>
<a class="sourceLine" id="cb500-22" data-line-number="22">  results &lt;-<span class="st"> </span><span class="kw">map</span>(.x, <span class="kw">safely</span>(.f), ...)</a>
<a class="sourceLine" id="cb500-23" data-line-number="23">  <span class="kw">list</span>(<span class="dt">result =</span> <span class="kw">bind_rows</span>(<span class="op">!!!</span><span class="kw">map</span>(results, <span class="st">&quot;result&quot;</span>)), <span class="dt">error =</span> <span class="kw">map</span>(results, <span class="st">&quot;error&quot;</span>))</a>
<a class="sourceLine" id="cb500-24" data-line-number="24">}    </a>
<a class="sourceLine" id="cb500-25" data-line-number="25"></a>
<a class="sourceLine" id="cb500-26" data-line-number="26"><span class="kw">map_dfr_safely</span>(list_data, semi_join, filter_starwars, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;height&quot;</span>))</a></code></pre></div>
<pre><code>## Warning in tbl_vars_dispatch(x): restarting interrupted promise evaluation

## Warning in tbl_vars_dispatch(x): restarting interrupted promise evaluation

## Warning in tbl_vars_dispatch(x): restarting interrupted promise evaluation</code></pre>
<pre><code>## $result
## # A tibble: 0 x 0
## 
## $error
## $error$a
## &lt;simpleError in tbl_vars_dispatch(x): object &#39;filter_starwars&#39; not found&gt;
## 
## $error$b
## &lt;simpleError in tbl_vars_dispatch(x): object &#39;filter_starwars&#39; not found&gt;
## 
## $error$c
## &lt;simpleError in tbl_vars_dispatch(x): object &#39;filter_starwars&#39; not found&gt;
## 
## $error$d
## &lt;simpleError in tbl_vars_dispatch(x): object &#39;filter_starwars&#39; not found&gt;</code></pre>
</div>
<div id="memoise" class="section level2 unnumbered">
<h2>11.2.2 memoise</h2>
<p>How do you check how much memory is allocated to memoise’s caching?</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb503-1" data-line-number="1">random_starwars &lt;-<span class="st"> </span><span class="cf">function</span>(...){ </a>
<a class="sourceLine" id="cb503-2" data-line-number="2">  starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb503-3" data-line-number="3"><span class="st">    </span><span class="kw">sample_n</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb503-4" data-line-number="4"><span class="st">    </span><span class="kw">select</span>(name)}</a>
<a class="sourceLine" id="cb503-5" data-line-number="5">memoised_starwars &lt;-<span class="st"> </span><span class="kw">memoise</span>(random_starwars)</a>
<a class="sourceLine" id="cb503-6" data-line-number="6">a &lt;-<span class="st"> </span><span class="kw">random_starwars</span>()</a>
<a class="sourceLine" id="cb503-7" data-line-number="7">b &lt;-<span class="st"> </span><span class="kw">memoised_starwars</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb503-8" data-line-number="8">c &lt;-<span class="st"> </span><span class="kw">memoised_starwars</span>(<span class="dv">2</span>)</a>
<a class="sourceLine" id="cb503-9" data-line-number="9">d &lt;-<span class="st"> </span><span class="kw">memoised_starwars</span>(<span class="dv">3</span>)</a>
<a class="sourceLine" id="cb503-10" data-line-number="10"></a>
<a class="sourceLine" id="cb503-11" data-line-number="11">lobstr<span class="op">::</span><span class="kw">obj_size</span>(<span class="kw">get</span>(<span class="st">&quot;_cache&quot;</span>,<span class="kw">environment</span>(memoised_starwars)))</a></code></pre></div>
<pre><code>## 16,232 B</code></pre>
<div class="question">
<p>Could we create a memoise wrapper that clears the cache when that’s a certain number?</p>
</div>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb505-1" data-line-number="1">random_starwars &lt;-<span class="st"> </span><span class="cf">function</span>(...){ </a>
<a class="sourceLine" id="cb505-2" data-line-number="2">  dplyr<span class="op">::</span>starwars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb505-3" data-line-number="3"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">sample_n</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb505-4" data-line-number="4"><span class="st">    </span>dplyr<span class="op">::</span><span class="kw">select</span>(name)</a>
<a class="sourceLine" id="cb505-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb505-6" data-line-number="6">cache_memory_size &lt;-<span class="st"> </span><span class="cf">function</span>(f) {</a>
<a class="sourceLine" id="cb505-7" data-line-number="7">  cache &lt;-<span class="st"> </span><span class="kw">get</span>(<span class="st">&quot;_cache&quot;</span>, <span class="kw">environment</span>(f))</a>
<a class="sourceLine" id="cb505-8" data-line-number="8">  lobstr<span class="op">::</span><span class="kw">obj_size</span>(cache)</a>
<a class="sourceLine" id="cb505-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb505-10" data-line-number="10">capped_memoise &lt;-<span class="st"> </span><span class="cf">function</span>(..., .cache_size) {</a>
<a class="sourceLine" id="cb505-11" data-line-number="11">  <span class="kw">force</span>(.cache_size)</a>
<a class="sourceLine" id="cb505-12" data-line-number="12">  .self_ref &lt;-<span class="st"> </span>memoise<span class="op">::</span><span class="kw">memoise</span>(...)</a>
<a class="sourceLine" id="cb505-13" data-line-number="13">  f &lt;-<span class="st"> </span><span class="cf">function</span>(...) {</a>
<a class="sourceLine" id="cb505-14" data-line-number="14">    env &lt;-<span class="st"> </span><span class="kw">parent.env</span>(<span class="kw">environment</span>())</a>
<a class="sourceLine" id="cb505-15" data-line-number="15">    cache_size &lt;-<span class="st"> </span><span class="kw">cache_memory_size</span>(env[[<span class="st">&quot;_self_ref&quot;</span>]])</a>
<a class="sourceLine" id="cb505-16" data-line-number="16">    <span class="cf">if</span> (cache_size <span class="op">&gt;</span><span class="st"> </span>env[[<span class="st">&quot;_cache_size&quot;</span>]]) {</a>
<a class="sourceLine" id="cb505-17" data-line-number="17">      <span class="kw">message</span>(<span class="kw">paste0</span>(<span class="st">&quot;Clearing cache [@&quot;</span>,cache_size,<span class="st">&quot;]</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb505-18" data-line-number="18">      memoise<span class="op">::</span><span class="kw">forget</span>(env[[<span class="st">&quot;_self_ref&quot;</span>]])</a>
<a class="sourceLine" id="cb505-19" data-line-number="19">    }</a>
<a class="sourceLine" id="cb505-20" data-line-number="20">    env[[<span class="st">&quot;_self_ref&quot;</span>]](...)</a>
<a class="sourceLine" id="cb505-21" data-line-number="21">  }</a>
<a class="sourceLine" id="cb505-22" data-line-number="22">  <span class="kw">assign</span>(<span class="st">&quot;_cache_size&quot;</span>, .cache_size, <span class="kw">environment</span>(.self_ref))</a>
<a class="sourceLine" id="cb505-23" data-line-number="23">  <span class="kw">assign</span>(<span class="st">&quot;_self_ref&quot;</span>, .self_ref, <span class="kw">environment</span>(.self_ref))</a>
<a class="sourceLine" id="cb505-24" data-line-number="24">  <span class="kw">environment</span>(f) &lt;-<span class="st"> </span><span class="kw">environment</span>(.self_ref)</a>
<a class="sourceLine" id="cb505-25" data-line-number="25">  f</a>
<a class="sourceLine" id="cb505-26" data-line-number="26">}</a>
<a class="sourceLine" id="cb505-27" data-line-number="27">capped_memoised_starwars &lt;-<span class="st"> </span><span class="kw">capped_memoise</span>(random_starwars, <span class="dt">.cache_size =</span> <span class="dv">30000</span>)</a>
<a class="sourceLine" id="cb505-28" data-line-number="28"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>) {</a>
<a class="sourceLine" id="cb505-29" data-line-number="29">  <span class="kw">capped_memoised_starwars</span>(i)</a>
<a class="sourceLine" id="cb505-30" data-line-number="30">  <span class="kw">print</span>(<span class="kw">cache_memory_size</span>(capped_memoised_starwars))</a>
<a class="sourceLine" id="cb505-31" data-line-number="31">}</a></code></pre></div>
<pre><code>## 14,472 B
## 15,368 B
## 16,280 B
## 17,104 B
## 18,000 B
## 18,848 B
## 19,744 B
## 20,576 B
## 21,480 B
## 22,320 B
## 23,240 B
## 24,080 B
## 24,968 B
## 25,808 B
## 26,664 B
## 27,376 B
## 28,272 B
## 29,048 B
## 29,824 B
## 30,664 B</code></pre>
<pre><code>## Clearing cache [@30664]</code></pre>
<pre><code>## 14,424 B
## 15,336 B
## 16,240 B
## 17,136 B
## 18,056 B
## 18,984 B
## 19,824 B
## 20,664 B
## 21,568 B
## 22,456 B
## 23,360 B
## 24,136 B
## 24,960 B
## 25,856 B
## 26,632 B
## 27,424 B
## 28,256 B
## 29,152 B
## 29,920 B
## 30,824 B</code></pre>
<pre><code>## Clearing cache [@30824]</code></pre>
<pre><code>## 14,456 B
## 15,368 B
## 16,280 B
## 17,184 B
## 18,024 B
## 18,944 B
## 19,656 B
## 20,552 B
## 21,376 B
## 22,200 B
## 22,912 B
## 23,808 B
## 24,648 B
## 25,360 B
## 26,152 B
## 26,984 B
## 27,824 B
## 28,664 B
## 29,496 B
## 30,328 B</code></pre>
<pre><code>## Clearing cache [@30328]</code></pre>
<pre><code>## 14,472 B
## 15,392 B
## 16,224 B
## 17,120 B
## 18,032 B
## 18,808 B
## 19,704 B
## 20,560 B
## 21,384 B
## 22,208 B
## 22,984 B
## 23,880 B
## 24,720 B
## 25,640 B
## 26,528 B
## 27,368 B
## 28,160 B
## 29,008 B
## 29,840 B
## 30,680 B</code></pre>
<pre><code>## Clearing cache [@30680]</code></pre>
<pre><code>## 14,424 B
## 15,336 B
## 16,240 B
## 17,136 B
## 18,048 B
## 18,952 B
## 19,848 B
## 20,560 B
## 21,392 B
## 22,232 B
## 23,088 B
## 23,864 B
## 24,576 B
## 25,352 B
## 26,184 B
## 27,072 B
## 27,896 B
## 28,672 B
## 29,504 B
## 30,360 B</code></pre>
<div class="question">
<p>Can we come up with simple example for these function operators?</p>
</div>
<div class="sourceCode" id="cb515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb515-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb515-2" data-line-number="2">  <span class="kw">c</span>(<span class="fl">0.512</span>, <span class="fl">0.165</span>, <span class="fl">0.717</span>),</a>
<a class="sourceLine" id="cb515-3" data-line-number="3">  <span class="kw">c</span>(<span class="fl">0.064</span>, <span class="fl">0.781</span>, <span class="fl">0.427</span>),</a>
<a class="sourceLine" id="cb515-4" data-line-number="4">  <span class="kw">c</span>(<span class="fl">0.890</span>, <span class="fl">0.785</span>, <span class="fl">0.495</span>),</a>
<a class="sourceLine" id="cb515-5" data-line-number="5">  <span class="st">&quot;oops&quot;</span></a>
<a class="sourceLine" id="cb515-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb515-7" data-line-number="7"></a>
<a class="sourceLine" id="cb515-8" data-line-number="8">f &lt;-<span class="st"> </span><span class="cf">function</span>(...) {<span class="kw">sum</span>(...)}</a></code></pre></div>
<div id="possibly" class="section level4 unnumbered">
<h4>possibly</h4>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb516-1" data-line-number="1"><span class="kw">map_dbl</span>(x, <span class="kw">possibly</span>(f, <span class="ot">NA</span>))</a></code></pre></div>
<pre><code>## [1] 1.394 1.272 2.170    NA</code></pre>
</div>
<div id="quietly" class="section level4 unnumbered">
<h4>quietly</h4>
<p>Quetly doesn’t work on errors, only warnings:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb518-1" data-line-number="1"><span class="kw">map</span>(x, <span class="kw">quietly</span>(<span class="cf">function</span>(x) <span class="kw">tryCatch</span>(<span class="kw">f</span>(x), <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="kw">warning</span>(e)))</a></code></pre></div>
</div>
<div id="auto_browser" class="section level4 unnumbered">
<h4>auto_browser</h4>
<div class="sourceCode" id="cb519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb519-1" data-line-number="1"><span class="kw">map_dbl</span>(x, <span class="kw">auto_browse</span>(f))</a></code></pre></div>
</div>
</div>
<div id="exercises-9" class="section level2 unnumbered">
<h2>11.2.3.1 Exercises</h2>
<div class="question">
<blockquote>
<p>Vectorize() provides a convenient and concise notation to iterate over multiple arguments, but has some major drawbacks that mean you generally shouldn’t use it.</p>
</blockquote>
<p>What are these drawbacks the solution manual is referring to?</p>
</div>
<div id="deans-way" class="section level4">
<h4><span class="header-section-number">11.0.0.1</span> <a href="https://deanattali.com/blog/mutate-non-vectorized/">Dean’s Way</a></h4>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb520-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb520-2" data-line-number="2">patient_name &lt;-<span class="st"> </span><span class="cf">function</span>(path) {</a>
<a class="sourceLine" id="cb520-3" data-line-number="3">  path_list &lt;-<span class="st"> </span><span class="kw">str_split</span>(path, <span class="st">&quot;/&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unlist</span>()</a>
<a class="sourceLine" id="cb520-4" data-line-number="4">  <span class="kw">paste</span>(path_list[<span class="kw">length</span>(path_list) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>], path_list[<span class="kw">length</span>(path_list)], <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</a>
<a class="sourceLine" id="cb520-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb520-6" data-line-number="6"></a>
<a class="sourceLine" id="cb520-7" data-line-number="7"><span class="co"># Vectorize it with Vectorize</span></a>
<a class="sourceLine" id="cb520-8" data-line-number="8">patient_name_v &lt;-<span class="st"> </span><span class="kw">Vectorize</span>(patient_name)</a>
<a class="sourceLine" id="cb520-9" data-line-number="9"><span class="kw">patient_name_v</span>(<span class="dt">path =</span> <span class="kw">c</span>(<span class="st">&quot;some/path/abc/001.txt&quot;</span>, <span class="st">&quot;another/directory/xyz/002.txt&quot;</span>))</a></code></pre></div>
<pre><code>##         some/path/abc/001.txt another/directory/xyz/002.txt 
##                 &quot;abc_001.txt&quot;                 &quot;xyz_002.txt&quot;</code></pre>
</div>
<div id="jims-way" class="section level4">
<h4><span class="header-section-number">11.0.0.2</span> <a href="https://www.jimhester.com/post/2018-04-12-vectorize/">Jim’s Way</a></h4>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb522-1" data-line-number="1">patient_name_best &lt;-<span class="st"> </span><span class="cf">function</span>(path) {</a>
<a class="sourceLine" id="cb522-2" data-line-number="2">  <span class="kw">paste0</span>(<span class="kw">basename</span>(<span class="kw">dirname</span>(path)), <span class="st">&quot;_&quot;</span>, <span class="kw">basename</span>(path))</a>
<a class="sourceLine" id="cb522-3" data-line-number="3">}</a></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>SIMPLIFY</code> logical or character string; attempt to reduce the result to a vector, matrix or higher dimensional array; see the simplify argument of sapply. <strong>This means the type of the function output depends on the input.</strong></li>
</ol>
<div class="sourceCode" id="cb523"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb523-1" data-line-number="1"><span class="kw">patient_name_v</span>(<span class="st">&quot;some/path/abc/001.txt&quot;</span>)</a></code></pre></div>
<pre><code>## some/path/abc/001.txt 
##         &quot;abc_001.txt&quot;</code></pre>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb525-1" data-line-number="1"><span class="kw">patient_name_v</span>(<span class="kw">character</span>())</a></code></pre></div>
<pre><code>## named list()</code></pre>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb527-1" data-line-number="1"><span class="kw">patient_name_v</span>(<span class="ot">NULL</span>)</a></code></pre></div>
<pre><code>## list()</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Vectorize does not generate functions with easily inspect-able code</li>
<li>Vectorize functions use <code>do.call()</code>, which can have unexpected performance consequences</li>
<li>Vectorize does not actually make your code execute faster</li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="function-factories.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="base-types.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/11-function_operators.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["AdvancedR_Companion.pdf", "AdvancedR_Companion.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
