<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Function factories | Advanced R Companion</title>
  <meta name="description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Function factories | Advanced R Companion" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Function factories | Advanced R Companion" />
  
  <meta name="twitter:description" content="This is a companion to Advanced R and supplement to Advanced R Solutions." />
  

<meta name="author" content="R4DS Reading Group" />


<meta name="date" content="2020-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="functionals.html"/>
<link rel="next" href="function-operators.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<img src="images/r4ds.png" style="width:300px;height:180px;padding-bottom:0px;"></img>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="welcome.html"><a href="welcome.html"><i class="fa fa-check"></i><b>1</b> Welcome</a></li>
<li class="chapter" data-level="2" data-path="names-and-values.html"><a href="names-and-values.html"><i class="fa fa-check"></i><b>2</b> Names and Values</a><ul>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#binding-basics"><i class="fa fa-check"></i>2.2 Binding basics</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#copy-on-modify"><i class="fa fa-check"></i>2.3 Copy-on-modify</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercises"><i class="fa fa-check"></i>2.2.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#function-calls"><i class="fa fa-check"></i>2.3.2 Function calls</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#lists"><i class="fa fa-check"></i>2.3.3 Lists</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#character-vectors"><i class="fa fa-check"></i>2.3.5 Character vectors</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#exercise"><i class="fa fa-check"></i>2.3.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#object-size"><i class="fa fa-check"></i>2.4.1 Object size</a></li>
<li class="chapter" data-level="" data-path="names-and-values.html"><a href="names-and-values.html#modify-in-place"><i class="fa fa-check"></i>2.5.1 Modify-in-place</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="vectors.html"><a href="vectors.html"><i class="fa fa-check"></i><b>3</b> Vectors</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#scalars"><i class="fa fa-check"></i>3.2.1 Scalars</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#missing-values"><i class="fa fa-check"></i>3.2.3 Missing values</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#testing-and-coercion"><i class="fa fa-check"></i>3.2.4 Testing and coercion</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#setting-attributes"><i class="fa fa-check"></i>3.3.1 Setting Attributes</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#setnames"><i class="fa fa-check"></i>3.3.2 setNames</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#dimensions"><i class="fa fa-check"></i>3.3.3 Dimensions</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#s3-atomic-vectors"><i class="fa fa-check"></i>3.4 S3 atomic vectors</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#dates"><i class="fa fa-check"></i>3.4.2 Dates</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#lists-1"><i class="fa fa-check"></i>3.5.1 Lists</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#data-frames-and-tibbles"><i class="fa fa-check"></i>3.6.8 Data frames and tibbles</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#conclusion"><i class="fa fa-check"></i>Conclusion</a><ul>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#vectorized"><i class="fa fa-check"></i>VECTORIZED:</a></li>
<li class="chapter" data-level="" data-path="vectors.html"><a href="vectors.html#non-vectorized"><i class="fa fa-check"></i>NON-VECTORIZED:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="subsetting.html"><a href="subsetting.html"><i class="fa fa-check"></i><b>4</b> Subsetting</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#introduction"><i class="fa fa-check"></i>4.1 Introduction</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#selecting-multiple-elements"><i class="fa fa-check"></i>4.2.1 Selecting multiple elements</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#lists-2"><i class="fa fa-check"></i>4.2.2 lists</a></li>
<li><a href="subsetting.html#section">4.3.1 <code>[[</code></a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#exercise-1"><i class="fa fa-check"></i>4.3.5 Exercise</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#missing-and-oob"><i class="fa fa-check"></i>4.3.3 Missing and OOB</a><ul>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#logical-atomic"><i class="fa fa-check"></i>LOGICAL ATOMIC</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#list"><i class="fa fa-check"></i>LIST</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#null"><i class="fa fa-check"></i>NULL</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#logical-subsetting"><i class="fa fa-check"></i>4.5.8 Logical subsetting</a></li>
<li class="chapter" data-level="" data-path="subsetting.html"><a href="subsetting.html#boolean-algebra"><i class="fa fa-check"></i>4.5.8 Boolean algebra</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="control-flow.html"><a href="control-flow.html"><i class="fa fa-check"></i><b>5</b> Control Flow</a><ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#vectorised-if"><i class="fa fa-check"></i>5.2.2 Vectorised if</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#loops"><i class="fa fa-check"></i>5.3 Loops</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#switch-statement"><i class="fa fa-check"></i>5.2.3 switch statement</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#common-pitfalls"><i class="fa fa-check"></i>5.3.1 common pitfalls</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#exercises-1"><i class="fa fa-check"></i>5.3.3.1 Exercises</a><ul>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#assignment-to-a-valid-index"><i class="fa fa-check"></i>Assignment to a valid index</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#assignment-to-0"><i class="fa fa-check"></i>Assignment to [0]</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#empty-index"><i class="fa fa-check"></i>Empty index</a></li>
<li><a href="control-flow.html#impossible-index">Impossible Index <code>[[</code></a></li>
<li><a href="control-flow.html#impossible-index--">Impossible Index <code>[[&lt;-</code></a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#undefined-name"><i class="fa fa-check"></i>Undefined name</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#out-of-bounds"><i class="fa fa-check"></i>Out of Bounds</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#conclusion-1"><i class="fa fa-check"></i>Conclusion</a></li>
<li class="chapter" data-level="" data-path="control-flow.html"><a href="control-flow.html#complexity"><i class="fa fa-check"></i>Complexity</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>6</b> Functions</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#primitives"><i class="fa fa-check"></i>6.2.2 Primitives</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercises-2"><i class="fa fa-check"></i>6.2.5.1 Exercises</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#function-composition"><i class="fa fa-check"></i>6.3 Function composition</a><ul>
<li class="chapter" data-level="6.0.1" data-path="functions.html"><a href="functions.html#nested"><i class="fa fa-check"></i><b>6.0.1</b> Nested</a></li>
<li class="chapter" data-level="6.0.2" data-path="functions.html"><a href="functions.html#intermediate"><i class="fa fa-check"></i><b>6.0.2</b> Intermediate</a></li>
<li class="chapter" data-level="6.0.3" data-path="functions.html"><a href="functions.html#piping"><i class="fa fa-check"></i><b>6.0.3</b> Piping</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#lexical-scoping"><i class="fa fa-check"></i>6.4 Lexical scoping</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#a-fresh-start"><i class="fa fa-check"></i>6.4.3 A fresh start</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i>6.5 Lazy evaluation</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#promises"><i class="fa fa-check"></i>6.5.1 Promises</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#default-arguments"><i class="fa fa-check"></i>6.5.2 Default arguments</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-2"><i class="fa fa-check"></i>6.5.4.3 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-3"><i class="fa fa-check"></i>6.5.4.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#dot-dot-dot"><i class="fa fa-check"></i>6.6 dot dot dot</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-4"><i class="fa fa-check"></i>6.6.1.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exit-handlers"><i class="fa fa-check"></i>6.7.4 Exit handlers</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-5"><i class="fa fa-check"></i>6.7.5.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-6"><i class="fa fa-check"></i>6.7.5.5 Exercise</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#replacement-functions"><i class="fa fa-check"></i>6.8.4 Replacement functions</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#exercise-7"><i class="fa fa-check"></i>6.8.6.3 Exercise</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="environments.html"><a href="environments.html"><i class="fa fa-check"></i><b>7</b> Environments</a><ul>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#parents"><i class="fa fa-check"></i>7.2.3 Parents</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#super-assignment"><i class="fa fa-check"></i>7.2.4 Super assignment</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#getting-and-setting"><i class="fa fa-check"></i>7.2.5 Getting and setting</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#advanced-bindings"><i class="fa fa-check"></i>7.2.6 Advanced bindings</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#recursing-over-environments"><i class="fa fa-check"></i>7.3 Recursing over environments</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#exercises-3"><i class="fa fa-check"></i>7.3.1.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#function-enviornment"><i class="fa fa-check"></i>7.4.2 Function enviornment</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#namespaces"><i class="fa fa-check"></i>7.4.3 Namespaces</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#call-stacks"><i class="fa fa-check"></i>7.5 Call stacks</a></li>
<li class="chapter" data-level="" data-path="environments.html"><a href="environments.html#data-structures"><i class="fa fa-check"></i>7.6 Data Structures</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="conditions.html"><a href="conditions.html"><i class="fa fa-check"></i><b>8</b> Conditions</a><ul>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#ignoring-conditions"><i class="fa fa-check"></i>8.3 Ignoring conditions</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exiting-handlers"><i class="fa fa-check"></i>8.4.2 Exiting handlers</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#calling-handlers"><i class="fa fa-check"></i>8.4.3 Calling handlers</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-4"><i class="fa fa-check"></i>8.4.5.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-5"><i class="fa fa-check"></i>8.4.5.3 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#resignal"><i class="fa fa-check"></i>8.6.3 Resignal</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#record"><i class="fa fa-check"></i>8.6.4 Record</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-6"><i class="fa fa-check"></i>8.6.6.2 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#exercises-7"><i class="fa fa-check"></i>8.6.6.4 Exercises</a></li>
<li class="chapter" data-level="" data-path="conditions.html"><a href="conditions.html#slides"><i class="fa fa-check"></i>Slides</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="functionals.html"><a href="functionals.html"><i class="fa fa-check"></i><b>9</b> Functionals</a><ul>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#anonymous-functions-and-shortcuts"><i class="fa fa-check"></i>9.2.2 Anonymous functions and shortcuts</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-8"><i class="fa fa-check"></i>9.2.6.4 Exercise</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-9"><i class="fa fa-check"></i>9.2.6.5 Exercise</a></li>
<li><a href="functionals.html#same-type-of-output-as-input-modify">9.4.1 Same type of output as input: <code>modify()</code></a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#any-number-of-inputs-pmap-and-friends"><i class="fa fa-check"></i>9.4.5 Any number of inputs: pmap() and friends</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-10"><i class="fa fa-check"></i>9.4.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#multiple-inputs"><i class="fa fa-check"></i>9.5.4 Multiple inputs</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-11"><i class="fa fa-check"></i>9.6.3.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#matrices-and-arrays"><i class="fa fa-check"></i>9.7.1 Matrices and arrays</a></li>
<li class="chapter" data-level="" data-path="functionals.html"><a href="functionals.html#exercise-12"><i class="fa fa-check"></i>9.7.3.2 Exercise</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="function-factories.html"><a href="function-factories.html"><i class="fa fa-check"></i><b>10</b> Function factories</a><ul>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#factory-fundamentals"><i class="fa fa-check"></i>10.2 Factory fundamentals</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#forcing-evaluation"><i class="fa fa-check"></i>10.2.3 Forcing evaluation</a></li>
<li class="chapter" data-level="10.1" data-path="function-factories.html"><a href="function-factories.html#without-force"><i class="fa fa-check"></i><b>10.1</b> WITHOUT FORCE</a><ul>
<li class="chapter" data-level="10.1.1" data-path="function-factories.html"><a href="function-factories.html#using-force"><i class="fa fa-check"></i><b>10.1.1</b> USING FORCE</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#garbage-collection"><i class="fa fa-check"></i>10.2.5 garbage collection</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#exercise-13"><i class="fa fa-check"></i>10.2.6.2 Exercise</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#exercise-14"><i class="fa fa-check"></i>10.2.6.3 Exercise</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#labelling"><i class="fa fa-check"></i>10.3.1 Labelling</a></li>
<li class="chapter" data-level="" data-path="function-factories.html"><a href="function-factories.html#exercises-8"><i class="fa fa-check"></i>10.3.4 Exercises</a></li>
<li class="chapter" data-level="10.2" data-path="function-factories.html"><a href="function-factories.html#factories-and-functionals"><i class="fa fa-check"></i><b>10.2</b> 10.5 factories and functionals</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="function-operators.html"><a href="function-operators.html"><i class="fa fa-check"></i><b>11</b> Function operators</a><ul>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#introduction-1"><i class="fa fa-check"></i>11.1 Introduction</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#purrrsafely"><i class="fa fa-check"></i>11.2.1 purrr::safely</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#memoise"><i class="fa fa-check"></i>11.2.2 memoise</a></li>
<li class="chapter" data-level="" data-path="function-operators.html"><a href="function-operators.html#exercises-9"><i class="fa fa-check"></i>11.2.3.1 Exercises</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Advanced R Companion</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="function-factories" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> Function factories</h1>
<div id="factory-fundamentals" class="section level2 unnumbered">
<h2>10.2 Factory fundamentals</h2>
<div class="question">
<p>Let’s really solidify this statement in our own words using the <code>power1</code> and <code>square</code>/<code>cube</code> example:</p>
<blockquote>
<p>The enclosing environment of the manufactured function is an execution environment of the function factory.</p>
</blockquote>
</div>
<p><img src="images/factories1.png" width="873" /></p>
<ul>
<li>enclosing environment (this is the function environment - like <code>square</code> and <code>cube</code>) [in red]</li>
<li>execution environment (this is the same environment as above but from the “perspective” of <code>power1</code>) [in green]</li>
</ul>
<p><code>square</code> and <code>cube</code> have their own enclosing environments where <code>x</code> is different for each function - but their parent, the environment of <code>power1</code>, is the same.</p>
<p>Because <code>power1</code> is a function, it has its own execution environment which is usually ephemeral but in this case it is the environment of both <code>square</code> and <code>cube</code> – and that is how the manufactured functions have access to <code>exp</code>.</p>
</div>
<div id="forcing-evaluation" class="section level2 unnumbered">
<h2>10.2.3 Forcing evaluation</h2>
<div class="question">
<p>I think this force section is trying to convey how we should use force on every argument in the factory’s execution environment (here just <code>exp</code>) because you want to avoid lazy eval in the manufactured function’s enclosing environment (like how we want to <code>force(exp = 2)</code> for <code>square</code>) but how does it not just become <code>force(exp = 3)</code> when we set <code>x &lt;- 3</code>?</p>
</div>
</div>
<div id="without-force" class="section level2">
<h2><span class="header-section-number">10.1</span> WITHOUT FORCE</h2>
<p>Without <code>force</code>, <code>exp</code> doesn’t get evaluated when <code>power</code> is called. <code>square</code> is a promise to create a function to raise its input to the <code>exp</code>’th power. Once <code>square</code> is called, the promise evaluates, and <code>square</code> becomes a function to raise its input to whatever <code>exp</code> was that first time <code>square</code> was called. That’s what makes it dangerous; what <code>square</code> does depends on the order in which things are called. Dangers and confusions like this are part of why function factories don’t get used that much, despite the fact that they’re really quite cool.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb461-1" data-line-number="1"><span class="kw">suppressMessages</span>(<span class="kw">requireNamespace</span>(<span class="st">&quot;pryr&quot;</span>))</a>
<a class="sourceLine" id="cb461-2" data-line-number="2"></a>
<a class="sourceLine" id="cb461-3" data-line-number="3"><span class="co"># make sure this isn&#39;t already defined</span></a>
<a class="sourceLine" id="cb461-4" data-line-number="4"><span class="kw">rm</span>(x)</a>
<a class="sourceLine" id="cb461-5" data-line-number="5"></a>
<a class="sourceLine" id="cb461-6" data-line-number="6">power2 &lt;-<span class="st"> </span><span class="cf">function</span>(exp) {</a>
<a class="sourceLine" id="cb461-7" data-line-number="7">  <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;outer execution environment: &quot;</span>, <span class="kw">capture.output</span>(<span class="kw">environment</span>()), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb461-8" data-line-number="8">  <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;outer enclosure: &quot;</span>, <span class="kw">capture.output</span>(<span class="kw">parent.env</span>(<span class="kw">environment</span>())), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb461-9" data-line-number="9">  <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;exp promise info: </span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="kw">capture.output</span>(pryr<span class="op">::</span><span class="kw">promise_info</span>(exp)), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)))</a>
<a class="sourceLine" id="cb461-10" data-line-number="10">  out &lt;-<span class="st"> </span><span class="cf">function</span>(x_) {</a>
<a class="sourceLine" id="cb461-11" data-line-number="11">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;inner execution environment: &quot;</span>, <span class="kw">capture.output</span>(<span class="kw">environment</span>()), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb461-12" data-line-number="12">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;inner enclosure: &quot;</span>, <span class="kw">capture.output</span>(<span class="kw">parent.env</span>(<span class="kw">environment</span>())), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb461-13" data-line-number="13">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;exp promise info: </span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="kw">capture.output</span>(pryr<span class="op">::</span><span class="kw">promise_info</span>(exp)), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)))</a>
<a class="sourceLine" id="cb461-14" data-line-number="14">    x_ <span class="op">^</span><span class="st"> </span>exp</a>
<a class="sourceLine" id="cb461-15" data-line-number="15">  }</a>
<a class="sourceLine" id="cb461-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb461-17" data-line-number="17"></a>
<a class="sourceLine" id="cb461-18" data-line-number="18">square &lt;-<span class="st"> </span><span class="kw">power2</span>(x)</a></code></pre></div>
<pre><code>#&gt; outer execution environment: &lt;environment: 0x0000000015812568&gt;
#&gt; outer enclosure: &lt;environment: R_GlobalEnv&gt;
#&gt; exp promise info: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  &lt;environment: R_GlobalEnv&gt;
#&gt;  
#&gt;  $evaled
#&gt;  [1] FALSE
#&gt;  
#&gt;  $value
#&gt;  NULL
#&gt;  </code></pre>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb463-1" data-line-number="1"><span class="kw">square</span>(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>#&gt; inner execution environment: &lt;environment: 0x0000000012aee2a8&gt;
#&gt; inner enclosure: &lt;environment: 0x0000000015812568&gt;
#&gt; exp promise info: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  &lt;environment: R_GlobalEnv&gt;
#&gt;  
#&gt;  $evaled
#&gt;  [1] FALSE
#&gt;  
#&gt;  $value
#&gt;  NULL
#&gt;  
#&gt; Error in square(4): object &#39;x&#39; not found</code></pre>
<p>The <code>exp</code> promise is looking for <code>x</code> in the enclosure of <code>power2</code> (global) and can’t find it.</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb465-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb465-2" data-line-number="2"><span class="kw">square</span>(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>#&gt; inner execution environment: &lt;environment: 0x0000000017c915d0&gt;
#&gt; inner enclosure: &lt;environment: 0x0000000015812568&gt;
#&gt; exp promise info: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  &lt;environment: R_GlobalEnv&gt;
#&gt;  
#&gt;  $evaled
#&gt;  [1] FALSE
#&gt;  
#&gt;  $value
#&gt;  NULL
#&gt;  
#&gt; Warning in square(4): restarting interrupted promise evaluation
#&gt; [1] 16</code></pre>
<p>Notice, that the <code>exp</code> promise still wasn’t evaled until the last line, <code>x_ ^ exp</code>. The warning is caused by our previous failed attempt to evaluate the promise.</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb467-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb467-2" data-line-number="2"><span class="kw">square</span>(<span class="dv">5</span>)</a></code></pre></div>
<pre><code>#&gt; inner execution environment: &lt;environment: 0x0000000017d9b270&gt;
#&gt; inner enclosure: &lt;environment: 0x0000000015812568&gt;
#&gt; exp promise info: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  NULL
#&gt;  
#&gt;  $evaled
#&gt;  [1] TRUE
#&gt;  
#&gt;  $value
#&gt;  [1] 2
#&gt;  
#&gt; [1] 25
# exp was evaled already, so no further warning is produced, and our change to x has no effect.</code></pre>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb469-1" data-line-number="1"><span class="kw">rm</span>(x)</a>
<a class="sourceLine" id="cb469-2" data-line-number="2">square &lt;-<span class="st"> </span><span class="kw">power2</span>(x)</a></code></pre></div>
<pre><code>#&gt; outer execution environment: &lt;environment: 0x0000000017e96e78&gt;
#&gt; outer enclosure: &lt;environment: R_GlobalEnv&gt;
#&gt; exp promise info: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  &lt;environment: R_GlobalEnv&gt;
#&gt;  
#&gt;  $evaled
#&gt;  [1] FALSE
#&gt;  
#&gt;  $value
#&gt;  NULL
#&gt;  </code></pre>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb471-1" data-line-number="1"><span class="kw">environment</span>(square)<span class="op">$</span>x &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb471-2" data-line-number="2"><span class="kw">square</span>(<span class="dv">6</span>)</a></code></pre></div>
<pre><code>#&gt; inner execution environment: &lt;environment: 0x0000000017f8a530&gt;
#&gt; inner enclosure: &lt;environment: 0x0000000017e96e78&gt;
#&gt; exp promise info: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  &lt;environment: R_GlobalEnv&gt;
#&gt;  
#&gt;  $evaled
#&gt;  [1] FALSE
#&gt;  
#&gt;  $value
#&gt;  NULL
#&gt;  
#&gt; Error in square(6): object &#39;x&#39; not found</code></pre>
<p>Defining <code>x</code> in the function environment doesn’t work, because the promise isn’t looking for <code>x</code> there</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb473-1" data-line-number="1">power2 &lt;-<span class="st"> </span><span class="cf">function</span>(exp) <span class="cf">function</span>(x_) x_ <span class="op">^</span><span class="st"> </span>exp</a>
<a class="sourceLine" id="cb473-2" data-line-number="2"><span class="co"># wasn&#39;t sure this would work without braces...neat</span></a>
<a class="sourceLine" id="cb473-3" data-line-number="3">square &lt;-<span class="st"> </span><span class="kw">power2</span>(x)</a>
<a class="sourceLine" id="cb473-4" data-line-number="4"><span class="kw">environment</span>(square)<span class="op">$</span>exp &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb473-5" data-line-number="5"><span class="kw">square</span>(<span class="dv">6</span>)</a></code></pre></div>
<pre><code>[1] 36</code></pre>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb475-1" data-line-number="1">square &lt;-<span class="st"> </span><span class="kw">power2</span>(x)</a>
<a class="sourceLine" id="cb475-2" data-line-number="2">exp &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb475-3" data-line-number="3"><span class="kw">square</span>(<span class="dv">6</span>)</a></code></pre></div>
<pre><code>Error in square(6): object &#39;x&#39; not found</code></pre>
<p>This doesn’t work because we need to define x within <code>environment(power2)$exp &lt;- 2</code></p>
<div id="using-force" class="section level3">
<h3><span class="header-section-number">10.1.1</span> USING FORCE</h3>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb477-1" data-line-number="1"><span class="kw">rm</span>(exp)</a>
<a class="sourceLine" id="cb477-2" data-line-number="2"><span class="kw">rm</span>(x, power2, square)</a>
<a class="sourceLine" id="cb477-3" data-line-number="3"></a>
<a class="sourceLine" id="cb477-4" data-line-number="4">power2 &lt;-<span class="st"> </span><span class="cf">function</span>(exp) {</a>
<a class="sourceLine" id="cb477-5" data-line-number="5">  <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;outer execution environment: &quot;</span>, <span class="kw">capture.output</span>(<span class="kw">environment</span>()), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb477-6" data-line-number="6">  <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;outer enclosure: &quot;</span>, <span class="kw">capture.output</span>(<span class="kw">parent.env</span>(<span class="kw">environment</span>())), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb477-7" data-line-number="7">  <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;exp promise info before: </span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="kw">capture.output</span>(pryr<span class="op">::</span><span class="kw">promise_info</span>(exp)), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)))</a>
<a class="sourceLine" id="cb477-8" data-line-number="8">  <span class="kw">force</span>(exp)</a>
<a class="sourceLine" id="cb477-9" data-line-number="9">  <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;exp promise info after: </span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="kw">capture.output</span>(pryr<span class="op">::</span><span class="kw">promise_info</span>(exp)), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)))</a>
<a class="sourceLine" id="cb477-10" data-line-number="10">  out &lt;-<span class="st"> </span><span class="cf">function</span>(x_) {</a>
<a class="sourceLine" id="cb477-11" data-line-number="11">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;inner execution environment: &quot;</span>, <span class="kw">capture.output</span>(<span class="kw">environment</span>()), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb477-12" data-line-number="12">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;inner enclosure: &quot;</span>, <span class="kw">capture.output</span>(<span class="kw">parent.env</span>(<span class="kw">environment</span>())), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>))</a>
<a class="sourceLine" id="cb477-13" data-line-number="13">    <span class="kw">cat</span>(<span class="kw">paste0</span>(<span class="st">&quot;exp promise info: </span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="kw">paste0</span>(<span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>, <span class="kw">capture.output</span>(pryr<span class="op">::</span><span class="kw">promise_info</span>(exp)), <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)))</a>
<a class="sourceLine" id="cb477-14" data-line-number="14">    x_ <span class="op">^</span><span class="st"> </span>exp</a>
<a class="sourceLine" id="cb477-15" data-line-number="15">  }</a>
<a class="sourceLine" id="cb477-16" data-line-number="16">}</a>
<a class="sourceLine" id="cb477-17" data-line-number="17"></a>
<a class="sourceLine" id="cb477-18" data-line-number="18">square &lt;-<span class="st"> </span><span class="kw">power2</span>(x)</a></code></pre></div>
<pre><code>#&gt; outer execution environment: &lt;environment: 0x00000000184e4e90&gt;
#&gt; outer enclosure: &lt;environment: R_GlobalEnv&gt;
#&gt; exp promise info before: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  &lt;environment: R_GlobalEnv&gt;
#&gt;  
#&gt;  $evaled
#&gt;  [1] FALSE
#&gt;  
#&gt;  $value
#&gt;  NULL
#&gt;  
#&gt; Error in force(exp): object &#39;x&#39; not found
# error because x isn&#39;t defined</code></pre>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb479-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb479-2" data-line-number="2">square &lt;-<span class="st"> </span><span class="kw">power2</span>(x)</a></code></pre></div>
<pre><code>#&gt; outer execution environment: &lt;environment: 0x0000000018cafaf8&gt;
#&gt; outer enclosure: &lt;environment: R_GlobalEnv&gt;
#&gt; exp promise info before: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  &lt;environment: R_GlobalEnv&gt;
#&gt;  
#&gt;  $evaled
#&gt;  [1] FALSE
#&gt;  
#&gt;  $value
#&gt;  NULL
#&gt;  exp promise info after: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  NULL
#&gt;  
#&gt;  $evaled
#&gt;  [1] TRUE
#&gt;  
#&gt;  $value
#&gt;  [1] 2
#&gt;  </code></pre>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" data-line-number="1"><span class="kw">square</span>(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>#&gt; inner execution environment: &lt;environment: 0x0000000018d55b48&gt;
#&gt; inner enclosure: &lt;environment: 0x0000000018cafaf8&gt;
#&gt; exp promise info: 
#&gt;  $code
#&gt;  x
#&gt;  
#&gt;  $env
#&gt;  NULL
#&gt;  
#&gt;  $evaled
#&gt;  [1] TRUE
#&gt;  
#&gt;  $value
#&gt;  [1] 2
#&gt;  
#&gt; [1] 16</code></pre>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb483-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb483-2" data-line-number="2"><span class="kw">square</span>(<span class="dv">4</span>)</a></code></pre></div>
</div>
</div>
<div id="garbage-collection" class="section level2 unnumbered">
<h2>10.2.5 garbage collection</h2>
<div class="question">
<p>Does {factory} handle the issue of temporary objects in the manufactured function not getting garbage collected?</p>
</div>
<p>We don’t need to use <code>rm</code> because the execution environment of the factory remains ephemeral (like any other function call).Rather than returning a function wrapped in the execution environment, it returns a function in the caller environment, allowing normal garbage collection to clean up the temporary objects created during creation of the manufactured functions.</p>
</div>
<div id="exercise-13" class="section level2 unnumbered">
<h2>10.2.6.2 Exercise</h2>
<div class="question">
<p>Base R contains two function factories, <code>approxfun()</code> and <code>ecdf()</code>. Read their documentation and experiment to figure out what the functions do and what they return.</p>
</div>
<div id="approxfun" class="section level4 unnumbered">
<h4>approxfun</h4>
<p><code>approxfun</code> creates a function (i.e. mathematical formula) that can be used to find the linear interpolation for any given point, based on the data that was passed into the factory-function at the time it was passed into the function</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1">dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x=</span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">y=</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb484-2" data-line-number="2">dat</a></code></pre></div>
<pre><code>##     x   y
## 1   1   1
## 2   2   4
## 3   3   9
## 4   4  16
## 5   5  25
## 6   6  36
## 7   7  49
## 8   8  64
## 9   9  81
## 10 10 100</code></pre>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" data-line-number="1">fn &lt;-<span class="st"> </span><span class="kw">approxfun</span>(dat<span class="op">$</span>x,dat<span class="op">$</span>y)</a>
<a class="sourceLine" id="cb486-2" data-line-number="2"><span class="kw">fn</span>(<span class="fl">4.5</span>)</a></code></pre></div>
<pre><code>## [1] 20.5</code></pre>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb488-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb488-3" data-line-number="3"><span class="kw">plot</span>(x, y, <span class="dt">main =</span> <span class="st">&quot;approx(.) and approxfun(.)&quot;</span>)</a>
<a class="sourceLine" id="cb488-4" data-line-number="4"><span class="kw">points</span>(<span class="kw">approx</span>(x, y), <span class="dt">col =</span> <span class="dv">2</span>, <span class="dt">pch =</span> <span class="st">&quot;*&quot;</span>)</a>
<a class="sourceLine" id="cb488-5" data-line-number="5"><span class="kw">points</span>(<span class="kw">approx</span>(x, y, <span class="dt">method =</span> <span class="st">&quot;constant&quot;</span>), <span class="dt">col =</span> <span class="dv">4</span>, <span class="dt">pch =</span> <span class="st">&quot;*&quot;</span>)</a></code></pre></div>
<p><img src="AdvancedR_Companion_files/figure-html/unnamed-chunk-237-1.png" width="672" /></p>
</div>
<div id="ecdf" class="section level4 unnumbered">
<h4>ECDF</h4>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb489-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">3</span>) <span class="co"># 3 random numbers</span></a>
<a class="sourceLine" id="cb489-2" data-line-number="2">Fn &lt;-<span class="st"> </span><span class="kw">ecdf</span>(x) <span class="co"># create distribution function for each x</span></a>
<a class="sourceLine" id="cb489-3" data-line-number="3"><span class="kw">Fn</span>(x) <span class="co"># apply the distribution function to each number</span></a></code></pre></div>
<pre><code>## [1] 0.3333333 0.6666667 1.0000000</code></pre>
</div>
</div>
<div id="exercise-14" class="section level2 unnumbered">
<h2>10.2.6.3 Exercise</h2>
<div class="question">
<p>How would we make this function using {factory}</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" data-line-number="1">pick &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb491-2" data-line-number="2">  <span class="kw">force</span>(i)</a>
<a class="sourceLine" id="cb491-3" data-line-number="3">  <span class="cf">function</span>(x) x[[i]]</a>
<a class="sourceLine" id="cb491-4" data-line-number="4">}</a></code></pre></div>
</div>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb492-1" data-line-number="1"><span class="kw">library</span>(factory)</a>
<a class="sourceLine" id="cb492-2" data-line-number="2">pick &lt;-<span class="st"> </span><span class="kw">build_factory</span>(</a>
<a class="sourceLine" id="cb492-3" data-line-number="3">  <span class="dt">.factory_fun =</span> <span class="cf">function</span>(x) x[[i]],</a>
<a class="sourceLine" id="cb492-4" data-line-number="4">  i</a>
<a class="sourceLine" id="cb492-5" data-line-number="5">)</a></code></pre></div>
</div>
<div id="labelling" class="section level2 unnumbered">
<h2>10.3.1 Labelling</h2>
<div class="question">
<p>What is the “factory” happening here? That we’re supplying a function as the <code>label</code> argument? Is <code>summarize</code> also a factory then?</p>
</div>
<p>It isn’t that the <code>ggplot2</code> functions are factories, it’s that they’re a great place to use factories. They’re actually functionals when you pass in a function, since they’re using a function as an argument!</p>
</div>
<div id="exercises-8" class="section level2 unnumbered">
<h2>10.3.4 Exercises</h2>
<div class="question">
<p>Can we use code to answer the question: compare and contrast ggplot2::label_bquote() with scales::number_format()</p>
</div>
<div class="TODO">
<p>Data:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb493-1" data-line-number="1">sd &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">15</span>)</a>
<a class="sourceLine" id="cb493-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb493-3" data-line-number="3">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">rnorm</span>(<span class="dv">3</span> <span class="op">*</span><span class="st"> </span>n, <span class="dt">sd =</span> sd), <span class="dt">sd =</span> <span class="kw">rep</span>(sd, n))</a></code></pre></div>
<p>Using <code>label_bquote</code> using <code>plotMath</code> explanation……</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" data-line-number="1"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb494-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb494-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>sd, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="dt">labeller =</span> <span class="kw">label_bquote</span>(alpha <span class="op">^</span><span class="st"> </span>.(sd))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb494-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>) </a></code></pre></div>
<p><img src="AdvancedR_Companion_files/figure-html/unnamed-chunk-242-1.png" width="672" /></p>
<p>Using <code>number_format</code> will <code>force</code> the computation of the parameters, formatting numbers explanation……</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb495-1" data-line-number="1"><span class="kw">ggplot</span>(df, <span class="kw">aes</span>(x)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb495-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb495-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>sd, <span class="dt">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb495-4" data-line-number="4"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb495-5" data-line-number="5"><span class="st">  </span><span class="kw">scale_y_continuous</span>(</a>
<a class="sourceLine" id="cb495-6" data-line-number="6">  <span class="dt">labels =</span> scales<span class="op">::</span><span class="kw">number_format</span>(<span class="dt">scale =</span> <span class="dv">1</span>, <span class="dt">suffix =</span> <span class="st">&quot; K&quot;</span>) </a>
<a class="sourceLine" id="cb495-7" data-line-number="7">)</a></code></pre></div>
<p><img src="AdvancedR_Companion_files/figure-html/unnamed-chunk-243-1.png" width="672" /></p>
</div>
</div>
<div id="factories-and-functionals" class="section level2">
<h2><span class="header-section-number">10.2</span> 10.5 factories and functionals</h2>
<div class="question">
<p>Can we {factory} this?</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" data-line-number="1">names &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb496-2" data-line-number="2">  <span class="dt">square =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb496-3" data-line-number="3">  <span class="dt">cube =</span> <span class="dv">3</span>, </a>
<a class="sourceLine" id="cb496-4" data-line-number="4">  <span class="dt">root =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>, </a>
<a class="sourceLine" id="cb496-5" data-line-number="5">  <span class="dt">cuberoot =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>, </a>
<a class="sourceLine" id="cb496-6" data-line-number="6">  <span class="dt">reciprocal =</span> <span class="dv">-1</span></a>
<a class="sourceLine" id="cb496-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb496-8" data-line-number="8">funs &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(names, power1)</a></code></pre></div>
</div>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb497-1" data-line-number="1">power4 &lt;-<span class="st"> </span><span class="kw">build_factory</span>(</a>
<a class="sourceLine" id="cb497-2" data-line-number="2">  <span class="dt">fun =</span> <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb497-3" data-line-number="3">    x <span class="op">^</span><span class="st"> </span>exponent</a>
<a class="sourceLine" id="cb497-4" data-line-number="4">  },</a>
<a class="sourceLine" id="cb497-5" data-line-number="5">  exponent</a>
<a class="sourceLine" id="cb497-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb497-7" data-line-number="7">power_names &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb497-8" data-line-number="8">  <span class="dt">square =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb497-9" data-line-number="9">  <span class="dt">cube =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb497-10" data-line-number="10">  <span class="dt">root =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb497-11" data-line-number="11">  <span class="dt">cuberoot =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb497-12" data-line-number="12">  <span class="dt">reciprocal =</span> <span class="dv">-1</span></a>
<a class="sourceLine" id="cb497-13" data-line-number="13">)</a>
<a class="sourceLine" id="cb497-14" data-line-number="14">powers &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map</span>(power_names, power4)</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="functionals.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="function-operators.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/10-function_factories.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["AdvancedR_Companion.pdf", "AdvancedR_Companion.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
